<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Atlasfn - Secure Payments</title>
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.stripe.com https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://api.stripe.com http://localhost:3000 https://*.onrender.com; frame-src https://js.stripe.com;">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous"/>
  <style>
    :root {
      --bg: #0f0f11;
      --card: #16161a;
      --text: #e0e0e0;
      --accent: #00d4ff;
      --accent-dark: #0099bb;
      --border: #2a2a32;
      --logo-bg: url('atlas_logo.png');
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    
    html {
      scroll-behavior: smooth;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes slideInDown {
      from {
        transform: translateY(-40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    body {
      font-family: 'Sora', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      animation: fadeIn 1s ease-in-out;
      position: relative;
      overflow-x: hidden;
      cursor: none;
    }

    button,
    a,
    input,
    select,
    textarea {
      cursor: none;
    }

    /* Hex Grid Background Canvas */
    #hexCanvas {
      position: fixed;
      top: 0;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      height: 100%;
      pointer-events: none;
      z-index: -1;
      backdrop-filter: blur(10px);
    }
    
    /* Landing Page */
    .landing-page {
      color: #f0e9ff;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, rgba(20,10,40,0.98), rgba(30,5,50,0.98));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
    }

      backdrop-filter: blur(10px);
    .landing-page.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .landing-content {
      text-align: center;
      max-width: 600px;
      padding: 2rem;
    }

    .landing-logo {
      margin-bottom: 2rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }

    .landing-title {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: linear-gradient(90deg, #a855f7, #ec4899, #f97316);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 20px rgba(168, 85, 247, 0.4));
      font-family: 'Sora', system-ui, sans-serif;
      letter-spacing: 3px;
    }

    .landing-subtitle {
      font-size: 1.3rem;
      color: #aaa;
      margin-bottom: 3rem;
      line-height: 1.8;
    }

    .landing-btn {
      padding: 1.2rem 3rem;
      font-size: 1.3rem;
      border: none;
      border-radius: 50px;
      background: linear-gradient(90deg, #a855f7, #ec4899);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sora', system-ui, sans-serif;
      box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
      letter-spacing: 2px;
    }

    .landing-btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 40px rgba(168, 85, 247, 0.6);
    }

    .landing-login-prompt {
      margin-top: 2rem;
      padding: 1.5rem;
      background: rgba(168, 85, 247, 0.1);
      border: 2px solid #a855f7;
      border-radius: 16px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
      50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
    }

    .landing-login-prompt h3 {
      color: #a855f7;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .landing-login-prompt p {
      color: #ccc;
      margin-bottom: 1.5rem;
    }

    .landing-auth-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .landing-auth-btn {
      padding: 0.8rem 2rem;
      border: 2px solid #a855f7;
      border-radius: 50px;
      background: transparent;
      color: #a855f7;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sora', system-ui, sans-serif;
    }

    .landing-auth-btn:hover {
      background: #a855f7;
      color: #fff;
      transform: translateY(-2px);
    }
    
    a { color: var(--accent); text-decoration: none; }
    a:hover { color: #fff; }

    header {
      background: linear-gradient(180deg, #0a0a0c, transparent);
      padding: 0.5rem 2%;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
      gap: 0.6rem;
    }
    .logo {
      font-size: 2.2rem;
      font-weight: 900;
      background: linear-gradient(90deg, #a855f7, #ec4899, #a855f7);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
      filter: drop-shadow(0 0 10px rgba(236, 72, 153, 0.4));
      letter-spacing: 2px;
    }
    .nav-links { display: flex; gap: 0.8rem; font-weight: 500; }
    #nav-auth { display: flex; gap: 0.25rem; align-items: center; }
    .nav-auth-hidden { display: none !important; }

    /* Hamburger Menu Button */
    .hamburger-menu {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 11000;
      background: rgba(168, 85, 247, 0.1);
      border: 2px solid var(--accent);
      border-radius: 12px;
      width: 50px;
      height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: all 0.3s;
      padding: 0;
    }

    .hamburger-menu.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .hamburger-menu:hover {
      background: rgba(168, 85, 247, 0.2);
      transform: scale(1.05);
    }

    .hamburger-menu span {
      width: 25px;
      height: 3px;
      background: var(--accent);
      border-radius: 3px;
      transition: all 0.3s;
    }

    .hamburger-menu:hover span {
      background: #fff;
    }

    /* Dropdown Menu */
    .sidebar-menu {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, #16161a 0%, #0a0a0c 100%);
      border-bottom: 2px solid var(--accent);
      z-index: 10500;
      transform: translateY(-110%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.35s ease, opacity 0.35s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      padding: 1.5rem 5% 1.75rem;
    }

    .sidebar-menu.active {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    .sidebar-header {
      padding: 0 0 1rem 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: none;
    }

    .sidebar-header h2 {
      color: var(--accent);
      font-size: 1.4rem;
      margin: 0;
    }

    .sidebar-close {
      background: none;
      border: none;
      color: var(--text);
      font-size: 2.5rem;
      cursor: pointer;
      transition: all 0.3s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .sidebar-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #ff6b6b;
      transform: rotate(90deg);
    }

    .sidebar-content {
      padding: 1rem 0 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.75rem;
    }

    .sidebar-section {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      color: #9aa0aa;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin: 0.5rem 0 0.2rem;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 0.9rem;
      padding: 1rem 1.1rem;
      margin-bottom: 0;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      text-decoration: none;
      font-size: 1.1rem;
      transition: all 0.3s;
      position: relative;
    }

    .sidebar-item:hover {
      background: rgba(168, 85, 247, 0.2);
      border-color: var(--accent);
      transform: translateX(-5px);
    }

    .sidebar-item i {
      font-size: 1.3rem;
      color: var(--accent);
      width: 30px;
      text-align: center;
    }

    .sidebar-badge {
      position: absolute;
      right: 1rem;
      background: linear-gradient(135deg, #ff6b6b, #ff0055);
      color: #fff;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 10000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .sidebar-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modern-modal {
      display: none;
      position: fixed;
      inset: 0;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      z-index: 11000;
      padding: 2rem;
    }

    /* Modal Tabs */
    .modern-modal-tabs {
      display: flex;
      gap: 0.5rem;
      padding: 0 2rem;
      border-bottom: 1px solid var(--border);
    }

    .modal-tab {
      padding: 1rem 1.5rem;
      background: none;
      border: none;
      color: #888;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.3s;
    }

    .modal-tab:hover {
      color: var(--text);
    }

    .modal-tab.active {
      color: var(--accent);
    }

    .modal-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
    }

    /* Tab Content */
    .support-tab-content,
    .settings-tab-content {
      display: none;
    }

    .support-tab-content.active,
    .settings-tab-content.active {
      display: block;
    }

    /* Form Groups */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-weight: 600;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      font-family: inherit;
      transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .form-group small {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }

    /* Settings Options */
    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      background: rgba(168, 85, 247, 0.05);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .settings-option h4 {
      margin: 0 0 0.5rem 0;
      color: var(--text);
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #333;
      transition: 0.4s;
      border-radius: 30px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: var(--accent);
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(30px);
    }

    /* Ticket Cards */
    .ticket-card {
      background: rgba(168, 85, 247, 0.05);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }

    .ticket-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .ticket-status {
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .ticket-status.open {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .ticket-status.in-progress {
      background: rgba(249, 115, 22, 0.2);
      color: #f97316;
    }

    .ticket-status.closed {
      background: rgba(156, 163, 175, 0.2);
      color: #9ca3af;
    }

    .ticket-priority {
      padding: 0.3rem 0.6rem;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .ticket-priority.low {
      background: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
    }

    .ticket-priority.medium {
      background: rgba(249, 115, 22, 0.2);
      color: #f97316;
    }

    .ticket-priority.high {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    /* Order History Table */
    .order-table {
      width: 100%;
      border-collapse: collapse;
    }

    .order-table th,
    .order-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .order-table th {
      color: var(--accent);
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.85rem;
    }

    .order-table td {
      color: var(--text);
    }

    .order-table tr:hover {
      background: rgba(168, 85, 247, 0.05);
    }

    .btn {
      padding: 0.7rem 1.5rem;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-primary {
      background: var(--accent);
      color: #000;
    }
    .btn-primary:hover { background: #fff; transform: translateY(-2px); }

    .hero {
      text-align: center;
      padding: 8rem 5% 6rem;
      
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(168,85,247,0.15), transparent);
      border-radius: 50%;
      filter: blur(60px);
    }
    .hero h1 {
      font-size: 3.8rem;
      margin-bottom: 1rem;
      color: #a855f7;
      filter: drop-shadow(0 0 15px rgba(168, 85, 247, 0.3));
    }
    .hero p {
      font-size: 1.4rem;
      max-width: 700px;
      margin: 0 auto 2.5rem;
      color: #a855f7;
    }

    .info-box {
      margin-top: 2rem;
      padding: 1rem 1.5rem;
      background: transparent;
      border: 1px solid var(--accent);
      border-radius: 12px;
      max-width: 650px;
      margin-left: auto;
      margin-right: auto;
    }

    .info-box p {
      margin: 0;
      color: var(--accent);
      font-size: 0.95rem;
    }

    .info-box i {
      margin-right: 0.3rem;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 5%; }

    .payment-section {
      text-align: center;
      padding: 4rem 0;
      background: transparent;
    }

    .payment-section h2 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(180deg, #a855f7 0%, #000 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .payment-section p {
      font-size: 1.1rem;
      color: transparent;
      background: linear-gradient(180deg, #a855f7 0%, #000 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 3rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .faq-section {
      padding: 4rem 0 5rem;
    }

    .faq-section h2 {
      font-size: 2.4rem;
      margin-bottom: 1rem;
      background: linear-gradient(90deg, var(--accent), #ff00aa);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
    }

    .faq-section p.section-intro {
      text-align: center;
      color: #aaa;
      margin-bottom: 2.5rem;
    }

    .faq-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.2rem;
    }

    .faq-item {
      background: rgba(22, 22, 26, 0.4);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.2rem;
      backdrop-filter: blur(10px);
    }

    .faq-item h3 {
      color: var(--accent);
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .faq-item p {
      color: #bbb;
      font-size: 0.95rem;
    }

    .payment-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1200px;
      margin: 0 auto 3rem;
    }

    .product-card {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.35s;
      position: relative;
      overflow: hidden;
    }

    .product-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      opacity: 0;
      transition: opacity 0.35s;
      z-index: -1;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.45);
    }

    .product-card:hover::before {
      opacity: 0.25;
    }

    .product-card-image {
      width: 100%;
      height: 180px;
      background: #000;
      border-radius: 12px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #a855f7;
      border: 1px solid var(--border);
    }

    .product-card-image i {
      color: transparent;
      background-image: linear-gradient(180deg, #a855f7 0%, #000 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .product-card-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #00d4ff, #00a0c8);
      color: #000;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .product-card-title {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .product-card-price {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(180deg, #a855f7 0%, #000 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .product-card-desc {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 1rem;
    }

    .btn-pay {
      width: 100%;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 50px;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-pay:hover {
      background: #fff;
      transform: translateY(-2px);
    }

    #card-element {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      margin: 1rem 0;
      font-family: inherit;
      font-size: 16px;
      min-height: 40px;
    }

    /* Stripe card element text visibility */
    .StripeElement {
      color: var(--text) !important;
      font-size: 16px !important;
    }

    .StripeElement::placeholder {
      color: #666 !important;
    }

    .payment-form-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      max-width: 400px;
      margin: 0 auto 4rem;
    }

    .product-detail-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      z-index: 11000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .product-detail-modal.active {
      display: flex;
    }

    .product-detail-content {
      background: rgba(22, 22, 26, 0.6);
      border: 1px solid var(--border);
      border-radius: 20px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 0;
      position: relative;
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      backdrop-filter: blur(15px);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .product-detail-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.5rem;
      color: var(--text);
      transition: all 0.3s;
      z-index: 10;
    }

    .product-detail-close:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #ff6b6b;
      transform: rotate(90deg);
    }

    .product-detail-header {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      padding: 2rem;
    }

    .product-detail-image {
      width: 100%;
      height: 350px;
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(0, 212, 255, 0.15) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5rem;
      color: var(--accent);
      border: 1px solid var(--border);
    }

    .product-detail-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .product-detail-badge {
      display: inline-block;
      background: linear-gradient(135deg, #00d4ff, #00a0c8);
      color: #000;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 1rem;
      width: fit-content;
    }

    .product-detail-title {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .product-detail-price {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent), #ff00aa);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1rem;
    }

    .product-detail-desc {
      font-size: 1rem;
      color: #aaa;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .product-detail-body {
      padding: 0 2rem 2rem;
    }

    .product-variants {
      margin-bottom: 2rem;
    }

    .product-variants h4 {
      color: var(--text);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .variant-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.8rem;
    }

    .variant-option {
      background: rgba(255, 255, 255, 0.03);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .variant-option:hover {
      background: rgba(168, 85, 247, 0.1);
      border-color: var(--accent);
    }

    .variant-option.selected {
      background: rgba(168, 85, 247, 0.2);
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
    }

    .variant-label {
      font-size: 0.9rem;
      color: var(--text);
      margin-bottom: 0.3rem;
    }

    .variant-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .product-quantity {
      margin-bottom: 2rem;
    }

    .product-quantity h4 {
      color: var(--text);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .quantity-btn {
      width: 45px;
      height: 45px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quantity-btn:hover {
      background: rgba(168, 85, 247, 0.2);
      border-color: var(--accent);
    }

    .quantity-display {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text);
      min-width: 50px;
      text-align: center;
    }

    .product-actions {
      display: flex;
      gap: 1rem;
    }

    .btn-add-cart,
    .btn-buy-now {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-add-cart {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid var(--accent);
      color: var(--accent);
    }

    .btn-add-cart:hover {
      background: rgba(168, 85, 247, 0.2);
      transform: translateY(-2px);
    }

    .btn-buy-now {
      background: linear-gradient(135deg, var(--accent), #ff00aa);
      color: #000;
    }

    .btn-buy-now:hover {
      background: linear-gradient(135deg, #ff00aa, var(--accent));
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
    }

    @media (max-width: 768px) {
      .product-detail-header {
        grid-template-columns: 1fr;
      }

      .product-detail-image {
        height: 250px;
      }

      .variant-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .product-actions {
        flex-direction: column;
      }
    }

    .form-group {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      font-size: 1rem;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.1);
    }

    /* Auth Modal Styles */
    .auth-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 11000;
    }

    .auth-modal.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .auth-modal-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 400px;
      width: 90%;
      animation: slideInDown 0.4s ease-out;
    }

    .auth-modal-content h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: var(--accent);
    }

    .auth-modal-content .form-group {
      margin-bottom: 1.2rem;
    }

    .auth-modal-content .form-group input {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      font-size: 0.95rem;
    }

    .auth-modal-content .form-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.1);
    }

    .auth-modal-btn {
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }

    .auth-modal-btn:hover {
      background: #fff;
      transform: translateY(-2px);
    }

    .auth-modal-toggle {
      text-align: center;
      color: #888;
      font-size: 0.9rem;
    }

    .auth-modal-toggle a {
      color: var(--accent);
      cursor: pointer;
      font-weight: 600;
    }

    .auth-modal-toggle a:hover {
      text-decoration: underline;
    }

    .auth-error {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
      padding: 0.8rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      display: none;
    }

    .auth-error.show {
      display: block;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .notif-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .notif-btn {
      position: relative;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .notif-btn:hover {
      transform: translateY(-1px);
      border-color: var(--accent);
    }

    .notif-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      border-radius: 999px;
      background: #ff6b6b;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.35);
    }

    .notif-dropdown {
      position: absolute;
      right: 0;
      top: calc(100% + 8px);
      min-width: 280px;
      max-width: 340px;
      background: #121218;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);
      padding: 0.6rem;
      display: none;
      z-index: 3000;
    }

    .notif-dropdown.open {
      display: block;
      animation: fadeIn 0.2s ease-in-out;
    }

    .notif-item {
      padding: 0.6rem 0.7rem;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      color: var(--text);
      transition: all 0.2s;
    }

    .notif-item:hover {
      background: rgba(0, 212, 255, 0.08);
    }

    .notif-item.unread {
      border: 1px solid rgba(0, 212, 255, 0.2);
      background: rgba(0, 212, 255, 0.06);
    }

    .notif-time {
      color: #aaa;
      font-size: 0.75rem;
    }

    .notif-empty {
      color: #888;
      font-size: 0.85rem;
      padding: 0.6rem;
      text-align: center;
    }

    .user-name {
      color: var(--text);
      font-weight: 500;
    }

    .logout-btn {
      padding: 0.5rem 1rem;
      background: #ff6b6b;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: #ff5252;
      transform: translateY(-2px);
    }

    .staff-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(90deg, #a855f7, #ec4899);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      font-weight: 600;
    }

    .staff-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(168, 85, 247, 0.4);
    }

    /* Staff Panel */
    .staff-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      overflow-y: auto;
      padding: 2rem;
    }

    .staff-panel.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .staff-panel-content {
      background: linear-gradient(180deg, #16161a, #0a0a0c);
      border: 2px solid #a855f7;
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(168, 85, 247, 0.3);
    }

    .staff-panel-content h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #a855f7, #ec4899);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .staff-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: rgba(168, 85, 247, 0.1);
      border: 1px solid #a855f7;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2rem;
      color: #a855f7;
      margin-bottom: 0.5rem;
    }

    .stat-card p {
      color: #aaa;
      font-size: 0.9rem;
    }

    .users-list {
      margin-top: 2rem;
    }

    .users-list h3 {
      color: var(--text);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    .user-item {
      background: rgba(168, 85, 247, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }

    .user-item:hover {
      border-color: #a855f7;
      background: rgba(168, 85, 247, 0.1);
    }

    .user-item.blacklisted {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
    }

    .user-item.timed-out {
      border-color: #ffa500;
      background: rgba(255, 165, 0, 0.1);
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .user-details {
      flex: 1;
    }

    .user-details h4 {
      color: var(--text);
      margin-bottom: 0.3rem;
      font-size: 1.1rem;
    }

    .user-details p {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    .user-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .badge {
      padding: 0.3rem 0.8rem;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-staff {
      background: linear-gradient(90deg, #a855f7, #ec4899);
      color: white;
    }

    .badge-blacklisted {
      background: #ff6b6b;
      color: white;
    }

    .badge-timeout {
      background: #ffa500;
      color: white;
    }

    .user-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .action-btn-timeout {
      background: #ffa500;
      color: white;
    }

    .action-btn-timeout:hover {
      background: #ff8c00;
      transform: translateY(-2px);
    }

    .action-btn-blacklist {
      background: #ff6b6b;
      color: white;
    }

    .action-btn-blacklist:hover {
      background: #ff5252;
      transform: translateY(-2px);
    }

    .action-btn-restore {
      background: #00d4ff;
      color: #000;
    }

    .action-btn-restore:hover {
      background: #00bfff;
      transform: translateY(-2px);
    }

    .action-btn-staff {
      background: #a855f7;
      color: white;
    }

    .action-btn-staff:hover {
      background: #9333ea;
      transform: translateY(-2px);
    }

    .action-btn-request {
      background: #ff6b00;
      color: white;
    }

    .action-btn-request:hover {
      background: #cc5500;
      transform: translateY(-2px);
    }

    .close-staff-btn {
      width: 100%;
      padding: 0.8rem;
      margin-top: 2rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .close-staff-btn:hover {
      background: var(--border);
    }

    /* Head Staff Panel */
    .head-staff-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(90deg, #dc2626, #991b1b);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      font-weight: 600;
    }

    .head-staff-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
    }

    .head-staff-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      overflow-y: auto;
      padding: 2rem;
    }

    .head-staff-panel.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .head-staff-panel-content {
      background: linear-gradient(180deg, #1a0606, #0a0a0a);
      border: 2px solid #dc2626;
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(220, 38, 38, 0.3);
    }

    .head-staff-panel-content h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #dc2626, #991b1b);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .badge-head-staff {
      background: linear-gradient(90deg, #dc2626, #991b1b);
      color: white;
    }

    /* Dev Panel */
    .dev-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(90deg, #ff0080, #ff6b00);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      font-weight: 600;
    }

    .dev-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 0, 128, 0.4);
    }

    .dev-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      overflow-y: auto;
      padding: 2rem;
    }

    .dev-panel.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .dev-panel-content {
      background: linear-gradient(180deg, #1a0a0a, #0a0a0a);
      border: 2px solid #ff0080;
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(255, 0, 128, 0.3);
    }

    .dev-panel-content h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #ff0080, #ff6b00);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Shared Panel UI */
    .panel-shell {
      background: linear-gradient(180deg, rgba(168, 85, 247, 0.22) 0%, rgba(0, 0, 0, 0.92) 100%);
      border: 1px solid rgba(168, 85, 247, 0.45);
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
      position: relative;
      backdrop-filter: blur(14px);
    }

    .panel-shell::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 22px;
      background: conic-gradient(from 0deg, transparent 0deg, rgba(168, 85, 247, 0.9) 90deg, transparent 180deg, rgba(168, 85, 247, 0.4) 270deg, transparent 360deg);
      animation: panelGlowSpin 6s linear infinite;
      z-index: -1;
      filter: blur(2px);
    }

    .panel-shell::after {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(168, 85, 247, 0.18) 0%, rgba(0, 0, 0, 0.88) 100%);
      z-index: -1;
    }

    @keyframes panelGlowSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .panel-shell-dev {
      border-color: rgba(255, 0, 128, 0.45);
      box-shadow: 0 30px 80px rgba(255, 0, 128, 0.2);
    }

    .panel-shell-head {
      border-color: rgba(220, 38, 38, 0.45);
      box-shadow: 0 30px 80px rgba(220, 38, 38, 0.2);
    }

    .panel-shell-staff {
      border-color: rgba(168, 85, 247, 0.45);
      box-shadow: 0 30px 80px rgba(168, 85, 247, 0.2);
    }

    .panel-shell-owner {
      border-color: rgba(255, 149, 0, 0.55);
      box-shadow: 0 30px 80px rgba(255, 149, 0, 0.22);
    }

    .dev-panel-content.panel-shell,
    .head-staff-panel-content.panel-shell,
    .staff-panel-content.panel-shell {
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 1000px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 1.5rem;
    }

    .panel-header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .panel-logo {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      border: 1px solid rgba(168, 85, 247, 0.45);
      background: rgba(10, 10, 12, 0.6);
      padding: 6px;
      object-fit: contain;
      filter: drop-shadow(0 0 14px rgba(168, 85, 247, 0.8));
    }

    .panel-title {
      font-size: 2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .panel-shell-dev .panel-title {
      background: linear-gradient(90deg, #ff0080, #ff6b00);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .panel-shell-head .panel-title {
      background: linear-gradient(90deg, #dc2626, #991b1b);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .panel-shell-staff .panel-title {
      background: linear-gradient(90deg, #a855f7, #7c3aed);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .panel-shell-owner .panel-title {
      background: linear-gradient(90deg, #ff9500, #ff6b00);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .panel-subtitle {
      color: #9aa0aa;
      font-size: 0.95rem;
      margin-top: 0.35rem;
    }

    .panel-role {
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .panel-role-dev {
      background: linear-gradient(90deg, #ff0080, #ff6b00);
      color: #0a0a0c;
    }

    .panel-role-head {
      background: linear-gradient(90deg, #dc2626, #991b1b);
      color: #fff;
    }

    .panel-role-staff {
      background: linear-gradient(90deg, #a855f7, #7c3aed);
      color: #0a0a0c;
    }

    .panel-role-owner {
      background: linear-gradient(90deg, #ff9500, #ff6b00);
      color: #0a0a0c;
    }

    .panel-perms {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .panel-perm {
      padding: 0.5rem 0.9rem;
      border-radius: 12px;
      background: rgba(168, 85, 247, 0.08);
      border: 1px solid rgba(168, 85, 247, 0.25);
      color: #cfd2d8;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .panel-perm strong {
      color: #fff;
    }

    .panel-block {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .panel-block h3 {
      margin-bottom: 1rem;
      font-size: 1.15rem;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .panel-input {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      font-size: 0.95rem;
    }

    .dev-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .dev-section {
      background: rgba(255, 0, 128, 0.05);
      border: 1px solid rgba(255, 0, 128, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .dev-section h3 {
      color: #ff0080;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .dev-action-btn {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 0.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .dev-action-btn-danger {
      background: #ff0080;
      color: white;
    }

    .dev-action-btn-danger:hover {
      background: #cc0066;
      transform: translateY(-2px);
    }

    .dev-action-btn-warning {
      background: #ff6b00;
      color: white;
    }

    .dev-action-btn-warning:hover {
      background: #cc5500;
      transform: translateY(-2px);
    }

    .dev-action-btn-info {
      background: #00d4ff;
      color: #000;
    }

    .dev-action-btn-info:hover {
      background: #00bfff;
      transform: translateY(-2px);
    }

    .dev-input {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 0.5rem;
      border: 1px solid rgba(255, 0, 128, 0.3);
      border-radius: 8px;
      background: #0a0a0c;
      color: var(--text);
      font-size: 0.9rem;
    }

    .dev-input:focus {
      outline: none;
      border-color: #ff0080;
      box-shadow: 0 0 0 2px rgba(255, 0, 128, 0.1);
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .analytics-card {
      background: rgba(0, 212, 255, 0.1);
      border: 1px solid #00d4ff;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .analytics-card h4 {
      font-size: 2rem;
      color: #00d4ff;
      margin-bottom: 0.3rem;
    }

    .analytics-card p {
      color: #888;
      font-size: 0.85rem;
    }

    .maintenance-mode-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a0a1a, #0a0a1a);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      flex-direction: column;
      text-align: center;
      padding: 2rem;
    }

    .maintenance-mode-overlay.active {
      display: flex;
    }

    .maintenance-mode-overlay h1 {
      font-size: 3rem;
      color: #ff0080;
      margin-bottom: 1rem;
    }

    .maintenance-mode-overlay p {
      font-size: 1.2rem;
      color: #888;
      max-width: 600px;
      margin-bottom: 2rem;
    }

    .badge-dev {
      background: linear-gradient(90deg, #ff0080, #ff6b00);
      color: white;
    }

    .badge-ipban {
      background: #ff0000;
      color: white;
    }

    .badge-apiban {
      background: #ff6b00;
      color: white;
    }

    /* Permissions Panel */
    .permissions-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(90deg, #00d4ff, #0099bb);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      font-weight: 600;
    }

    .permissions-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
    }

    .permissions-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2500;
      overflow-y: auto;
      padding: 2rem;
    }

    .permissions-panel.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    .permissions-panel-content {
      background: linear-gradient(180deg, #0a1a1a, #0a0a0a);
      border: 2px solid #00d4ff;
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 212, 255, 0.3);
    }

    .permissions-panel-content h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #00d4ff, #0099bb);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .permission-item {
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 12px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }

    .permission-item:hover {
      border-color: #00d4ff;
      background: rgba(0, 212, 255, 0.1);
    }

    .permission-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .permission-details {
      flex: 1;
    }

    .permission-details h4 {
      color: var(--text);
      margin-bottom: 0.3rem;
      font-size: 1.1rem;
    }

    .permission-details p {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    .permission-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .panel-message {
      display: none;
      padding: 0.75rem 1rem;
      border-radius: 10px;
      margin: 1rem 0;
      font-size: 0.9rem;
      border: 1px solid transparent;
    }

    .panel-message.show {
      display: block;
    }

    .panel-message.info {
      background: rgba(0, 212, 255, 0.08);
      border-color: rgba(0, 212, 255, 0.4);
      color: #8be9ff;
    }

    .panel-message.success {
      background: rgba(0, 255, 136, 0.08);
      border-color: rgba(0, 255, 136, 0.4);
      color: #7dffb7;
    }

    .panel-message.error {
      background: rgba(255, 107, 107, 0.08);
      border-color: rgba(255, 107, 107, 0.4);
      color: #ff9b9b;
    }

    .panel-controls {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .panel-select {
      padding: 0.6rem 0.8rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #0a0a0c;
      color: var(--text);
      font-size: 0.9rem;
    }

    .ban-list {
      margin-top: 0.75rem;
      display: none;
      border-top: 1px solid var(--border);
      padding-top: 0.75rem;
    }

    .ban-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 0.6rem;
      background: rgba(255, 255, 255, 0.02);
    }

    .ban-item button {
      padding: 0.45rem 0.75rem;
      border: none;
      border-radius: 8px;
      background: #ff6b6b;
      color: white;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .ban-item button:hover {
      background: #ff5252;
      transform: translateY(-1px);
    }

    .request-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.9rem 1rem;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.02);
      margin-bottom: 0.8rem;
    }

    .request-item.highlight {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .request-meta {
      color: #aaa;
      font-size: 0.85rem;
    }

    .request-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .request-actions button {
      padding: 0.45rem 0.9rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all 0.2s;
    }

    .request-actions .approve-btn {
      background: #00d4ff;
      color: #000;
    }

    .request-actions .deny-btn {
      background: #ff6b6b;
      color: white;
    }

    .request-actions button:hover {
      transform: translateY(-1px);
    }

    .action-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 12000;
      padding: 1.5rem;
    }

    .action-modal.active {
      display: flex;
      animation: fadeIn 0.2s ease-in-out;
    }

    .action-modal-content {
      background: linear-gradient(180deg, #121218, #0a0a0c);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.8rem;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .action-modal-content h3 {
      margin-bottom: 0.8rem;
      color: #fff;
      font-size: 1.4rem;
    }

    .action-modal-content p {
      color: #bbb;
      margin-bottom: 1.2rem;
      line-height: 1.5;
    }

    .action-modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .modal-confirm,
    .modal-cancel {
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .modal-confirm {
      background: #00d4ff;
      color: #000;
    }

    .modal-confirm.danger {
      background: #ff6b6b;
      color: #fff;
    }

    .modal-confirm.warning {
      background: #ff6b00;
      color: #fff;
    }

    .modal-cancel {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .modal-confirm:hover,
    .modal-cancel:hover {
      transform: translateY(-1px);
    }

    #global-toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 13000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .toast {
      padding: 0.75rem 1rem;
      border-radius: 10px;
      border: 1px solid transparent;
      background: #121218;
      color: #fff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      font-size: 0.9rem;
    }

    .toast.success {
      border-color: rgba(0, 255, 136, 0.6);
      color: #7dffb7;
    }

    .toast.error {
      border-color: rgba(255, 107, 107, 0.6);
      color: #ff9b9b;
    }

    .ban-banner {
      position: fixed;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%) translateX(120%);
      padding: 0.85rem 1.1rem;
      background: rgba(18, 18, 24, 0.95);
      border: 1px solid rgba(255, 107, 107, 0.6);
      border-radius: 12px;
      color: #ff9b9b;
      font-weight: 700;
      letter-spacing: 0.2px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
      z-index: 13000;
      transition: transform 0.25s ease-out, opacity 0.25s ease-out;
      opacity: 0;
      max-width: 260px;
      text-transform: lowercase;
    }

    .ban-banner.show {
      transform: translateY(-50%) translateX(0);
      opacity: 1;
    }

    .test-mode-banner {
      position: fixed;
      left: 50%;
      top: 1rem;
      transform: translateX(-50%);
      background: rgba(255, 107, 0, 0.95);
      color: #0a0a0c;
      padding: 0.6rem 1rem;
      border-radius: 12px;
      z-index: 14000;
      display: none;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
    }

    .test-mode-banner button {
      background: #0a0a0c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.35rem 0.75rem;
      cursor: pointer;
      font-weight: 600;
    }

    .test-mode-banner.show {
      display: flex;
    }

    .privacy-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 10, 12, 0.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 15000;
      padding: 2rem;
      text-align: center;
    }

    .privacy-overlay.active {
      display: flex;
    }

    .privacy-overlay-content {
      max-width: 520px;
      border: 1px solid rgba(255, 107, 107, 0.45);
      border-radius: 16px;
      background: #121218;
      padding: 2rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
    }

    .privacy-overlay-content h3 {
      margin-bottom: 0.75rem;
      color: #ff9b9b;
      font-size: 1.3rem;
    }

    .privacy-overlay-content p {
      color: #c9c9d1;
      font-size: 0.95rem;
    }

    .grant-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .grant-btn-staff {
      background: #a855f7;
      color: white;
    }

    .grant-btn-staff:hover {
      background: #9333ea;
      transform: translateY(-2px);
    }

    .grant-btn-dev {
      background: #ff0080;
      color: white;
    }

    .grant-btn-dev:hover {
      background: #cc0066;
      transform: translateY(-2px);
    }

    .grant-btn-revoke {
      background: #ff6b6b;
      color: white;
    }

    .grant-btn-revoke:hover {
      background: #ff5252;
      transform: translateY(-2px);
    }

    footer {
      background: #0a0a0c;
      padding: 4rem 5% 2rem;
      text-align: center;
      border-top: 1px solid var(--border);
    }
    .footer-links { display: flex; justify-content: center; gap: 2rem; margin: 1.5rem 0; flex-wrap: wrap; }
    .footer-links a { color: #888; font-size: 0.95rem; }
    .footer-links a:hover { color: var(--accent); }

    @media (max-width: 768px) {
      .hero h1 { font-size: 2.8rem; }
      .nav-links { display: none; } /* add burger menu if needed */
    }

    /* Custom Crosshair Cursor */
    * {
      cursor: none !important;
    }

    /* Allow normal cursor on inputs and interactive elements */
    input, textarea, select, button, a {
      cursor: pointer !important;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="tel"],
    textarea {
      cursor: text !important;
    }

    .crosshair {
      position: fixed;
      width: 30px;
      height: 30px;
      pointer-events: none;
      z-index: 13000;
      transform: translate(-50%, -50%);
      transition: transform 0.1s ease-out;
    }

    .crosshair::before,
    .crosshair::after {
      content: '';
      position: absolute;
      background: linear-gradient(90deg, #a855f7, #000);
      box-shadow: 0 0 10px #a855f7;
    }

    .crosshair::before {
      width: 2px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .crosshair::after {
      height: 2px;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
    }

    .crosshair-center {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #a855f7;
      border: 2px solid #000;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px #a855f7, inset 0 0 5px #fff;
    }

    /* Shockwave Animation */

    /* Click Shockwave Effect */
    .shockwave {
      position: fixed;
      width: 20px;
      height: 20px;
      border: 3px solid #a855f7;
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      animation: shockwaveExpand 0.6s ease-out forwards;
    }

    @keyframes shockwaveExpand {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        border-width: 3px;
      }
      50% {
        opacity: 0.6;
        border-width: 2px;
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(5.3);
        border-width: 1px;
      }
    }

  </style>
</head>
<body>
  <!-- Hex Grid Background Canvas -->
  <canvas id="hexCanvas"></canvas>

  <!-- Hamburger Menu Button -->
  <button class="hamburger-menu" id="hamburgerBtn" onclick="toggleSidebar()">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Sidebar Menu -->
  <div class="sidebar-menu" id="sidebarMenu">
    <div class="sidebar-header">
      <h2><i class="fas fa-user-circle"></i> Account Menu</h2>
      <button class="sidebar-close" onclick="toggleSidebar()"></button>
    </div>
    <div class="sidebar-content">
      <div class="sidebar-section"><i class="fas fa-layer-group"></i> Panels</div>
      <a href="#" class="sidebar-item" id="menu-dev-panel" onclick="openDevPanel(); toggleSidebar();" style="display: none;">
        <i class="fas fa-code"></i>
        <span>Developer Panel</span>
      </a>
      <a href="#" class="sidebar-item" id="menu-head-panel" onclick="openHeadStaffPanel(); toggleSidebar();" style="display: none;">
        <i class="fas fa-crown"></i>
        <span>Head Staff Panel</span>
      </a>
      <a href="#" class="sidebar-item" id="menu-staff-panel" onclick="openStaffPanel(); toggleSidebar();" style="display: none;">
        <i class="fas fa-shield-alt"></i>
        <span>Staff Panel</span>
      </a>
      <div class="sidebar-section"><i class="fas fa-user"></i> Account</div>
      <a href="#" class="sidebar-item" onclick="openOrderHistory()">
        <i class="fas fa-shopping-bag"></i>
        <span>Order History</span>
      </a>
      <a href="#" class="sidebar-item" onclick="openSupport()">
        <i class="fas fa-headset"></i>
        <span>Support</span>
        <span class="sidebar-badge" id="ticketBadge" style="display: none;">0</span>
      </a>
      <a href="#" class="sidebar-item" onclick="openSettings()">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
      <a href="#" class="sidebar-item" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sign Out</span>
      </a>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <!-- Landing Page -->
  <div class="landing-page hidden" id="landingPage" style="display: none;">
    <div class="landing-content">
      <div class="landing-logo">
        <img src="atlas_logo.png" class="atlas-logo" alt="Atlasfn Logo" width="150" height="150" style="filter: drop-shadow(0 0 30px rgba(168, 85, 247, 0.8)); object-fit: contain;" onerror="handleLogoError(this)">
      </div>
      
      <h1 class="landing-title">ATLASFN</h1>
      <p class="landing-subtitle">Secure payment platform powered by cutting-edge technology</p>
      
      <!-- Content that changes based on login status -->
      <div id="landingLoggedIn" style="display: none;">
        <button class="landing-btn" onclick="goToStore()">ENTER STORE</button>
      </div>
      
      <div id="landingLoggedOut">
        <div class="landing-login-prompt">
          <h3> Secure Access Required</h3>
          <p>Please sign in to access the store</p>
          <div class="landing-auth-buttons">
            <button class="landing-auth-btn" onclick="window.open('login.html', '_blank')">LOG IN</button>
            <button class="landing-auth-btn" onclick="window.open('signup.html', '_blank')">SIGN UP</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Crosshair Cursor -->
  <div class="crosshair" id="crosshair">
    <div class="crosshair-center"></div>
  </div>

  <header>
    <nav>
      <img src="atlas_logo.png" class="atlas-logo" alt="Atlasfn Logo" width="100" height="100" style="margin-right: 2px; vertical-align: middle; filter: drop-shadow(0 0 20px rgba(168, 85, 247, 0.9)); object-fit: contain;" onerror="handleLogoError(this)">
      <span style="vertical-align: middle; font-family: 'Sora', system-ui, sans-serif; font-size: 1.8rem; background: linear-gradient(180deg, #a855f7 0%, #000 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Atlasfn</span>
      <div class="nav-links">
        <a href="#store-section">Store</a>
        <a href="#">About</a>
        <a href="#faq">FAQ</a>
        <a href="https://discord.gg/Y6jVxPVV" target="_blank" title="Join our Discord">
          <i class="fab fa-discord"></i> Discord
        </a>
      </div>
      <div id="nav-auth">
        <a href="login.html" target="_blank" style="color: var(--accent); text-decoration: none; padding: 0.5rem 1rem; border: 1px solid var(--accent); border-radius: 8px; transition: all 0.3s;">
          <i class="fas fa-sign-in-alt"></i> Login
        </a>
        <a href="signup.html" target="_blank" style="color: var(--text); text-decoration: none; padding: 0.5rem 1rem; background: var(--accent); color: #000; border-radius: 8px; margin-left: 0.5rem; font-weight: 600; transition: all 0.3s;">
          <i class="fas fa-user-plus"></i> Sign Up
        </a>
      </div>
      <div id="user-menu" class="user-menu" style="display: none;">
        <span class="user-name" id="user-display"></span>
        <button class="logout-btn" onclick="logout()">Log Out</button>
      </div>
    </nav>
  </header>

  <!-- Login Modal -->
  <div class="auth-modal" id="loginModal">
    <div class="auth-modal-content">
      <h2><i class="fas fa-sign-in-alt"></i> Log In</h2>
      <div class="auth-error" id="loginError"></div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="loginEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="loginPassword" placeholder="Password">
      </div>
      <button class="auth-modal-btn" onclick="handleLogin()">Log In</button>
      <div class="auth-modal-toggle">
        Don't have an account? <a onclick="switchToSignup()">Sign Up</a>
      </div>
      <button class="auth-modal-btn" style="background: transparent; border: 1px solid var(--border); color: var(--text); margin-top: 1rem;" onclick="closeModal('loginModal')">Cancel</button>
    </div>
  </div>

  <!-- Maintenance Mode Overlay -->
  <div class="maintenance-mode-overlay" id="maintenanceOverlay">
    <img src="atlas_logo.png" class="atlas-logo" alt="Atlasfn Logo" width="200" height="200" style="filter: drop-shadow(0 0 30px rgba(168, 85, 247, 0.8)); margin-bottom: 2rem;" onerror="handleLogoError(this)">
    <h1><i class="fas fa-tools"></i> MAINTENANCE MODE</h1>
    <p>The site is currently under maintenance. We'll be back soon with improvements!</p>
    <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">Administrators can still access all features.</p>
  </div>


  <!-- Dev Panel -->
  <div class="dev-panel" id="devPanel">
    <div class="dev-panel-content panel-shell panel-shell-dev">
      <div class="panel-header">
        <div class="panel-header-left">
          <img src="atlas_logo.png" class="panel-logo" alt="Atlasfn Logo" onerror="handleLogoError(this)">
          <div>
            <h2 class="panel-title"><i class="fas fa-code"></i> Developer Control Panel</h2>
            <p class="panel-subtitle">Full system access, enforcement, and configuration controls</p>
          </div>
        </div>
        <span class="panel-role panel-role-dev">Developer</span>
      </div>
      <div class="panel-perms">
        <span class="panel-perm"><i class="fas fa-user-shield"></i> Manage roles</span>
        <span class="panel-perm"><i class="fas fa-ban"></i> Ban / IP / API</span>
        <span class="panel-perm"><i class="fas fa-database"></i> Data control</span>
        <span class="panel-perm"><i class="fas fa-tools"></i> Maintenance</span>
      </div>
      <div id="dev-message" class="panel-message"></div>
      
      <div class="dev-sections">
        <!-- Account Management -->
        <div class="dev-section">
          <h3><i class="fas fa-user-slash"></i> Account Management</h3>
          <input type="email" id="dev-target-email" class="dev-input" placeholder="Enter user email">
          <button class="dev-action-btn dev-action-btn-danger" onclick="deleteAccount()">
            <i class="fas fa-trash"></i> Delete Account
          </button>
          <button class="dev-action-btn dev-action-btn-danger" onclick="permanentBan()">
            <i class="fas fa-ban"></i> Permanent Ban
          </button>
        </div>

        <!-- IP Management -->
        <div class="dev-section">
          <h3><i class="fas fa-network-wired"></i> IP Management</h3>
          <input type="text" id="dev-ip-address" class="dev-input" placeholder="Enter IP address (e.g., 192.168.1.1)">
          <button class="dev-action-btn dev-action-btn-danger" onclick="ipBan()">
            <i class="fas fa-ban"></i> IP Ban
          </button>
          <button class="dev-action-btn dev-action-btn-info" onclick="viewIPBans()">
            <i class="fas fa-list"></i> View IP Bans (<span id="ipBanCount">0</span>)
          </button>
          <div id="dev-ip-bans" class="ban-list"></div>
        </div>

        <!-- API Management -->
        <div class="dev-section">
          <h3><i class="fas fa-plug"></i> API Management</h3>
          <input type="email" id="dev-api-email" class="dev-input" placeholder="Enter user email">
          <button class="dev-action-btn dev-action-btn-warning" onclick="apiBan()">
            <i class="fas fa-ban"></i> API Ban User
          </button>
          <button class="dev-action-btn dev-action-btn-info" onclick="viewAPIBans()">
            <i class="fas fa-list"></i> View API Bans (<span id="apiBanCount">0</span>)
          </button>
          <div id="dev-api-bans" class="ban-list"></div>
        </div>

        <!-- Panel Granter -->
        <div class="dev-section">
          <h3><i class="fas fa-unlock-alt"></i> Panel Granter</h3>
          <input type="email" id="dev-grant-email" class="dev-input" placeholder="Enter user email">
          <button class="dev-action-btn dev-action-btn-info" onclick="grantAllPanelsByEmail()">
            <i class="fas fa-unlock"></i> Grant All Panels
          </button>
        </div>

        <!-- User Moderation -->
        <div class="dev-section" style="grid-column: 1 / -1;">
          <h3><i class="fas fa-user-slash"></i> User Moderation</h3>
          <p style="color: #888; margin-bottom: 1rem;">Timeout durations: 30 min, 1 hr, 5 hr, 24 hr, 48 hr, or 1 week.</p>
          <div class="panel-controls">
            <label for="dev-timeout-duration" style="color: #aaa; font-size: 0.85rem;">Timeout duration</label>
            <select id="dev-timeout-duration" class="panel-select">
              <option value="30">30 min</option>
              <option value="60">1 hr</option>
              <option value="300">5 hr</option>
              <option value="1440">24 hr</option>
              <option value="2880">48 hr</option>
              <option value="10080">1 week</option>
            </select>
          </div>
          <div id="dev-users-container">
            <!-- Users will be loaded here -->
          </div>
        </div>

        <!-- User Permissions Management -->
        <div class="dev-section" style="grid-column: 1 / -1;">
          <h3><i class="fas fa-user-shield"></i> User Permissions Management</h3>
          <div id="dev-permissions-list" style="margin-top: 1rem; max-height: 400px; overflow-y: auto;">
            <!-- Users will be loaded here -->
          </div>
        </div>

        <!-- Ban Requests -->
        <div class="dev-section" style="grid-column: 1 / -1;">
          <h3><i class="fas fa-flag"></i> Ban Requests</h3>
          <div id="dev-ban-requests" style="margin-top: 1rem;">
            <!-- Requests will be loaded here -->
          </div>
        </div>

        <!-- User Overview -->
        <div class="dev-section" style="grid-column: 1 / -1;">
          <h3><i class="fas fa-chart-bar"></i> User Overview</h3>
          <div class="analytics-grid" style="margin-bottom: 1.5rem;">
            <div class="analytics-card">
              <h4 id="overview-total-users">0</h4>
              <p>Total Users</p>
            </div>
            <div class="analytics-card">
              <h4 id="overview-active-users">0</h4>
              <p>Active Users</p>
            </div>
            <div class="analytics-card">
              <h4 id="overview-staff-count">0</h4>
              <p>Staff Members</p>
            </div>
            <div class="analytics-card">
              <h4 id="overview-banned-count">0</h4>
              <p>Banned Users</p>
            </div>
          </div>
          <div id="dev-user-overview" style="max-height: 400px; overflow-y: auto;">
            <!-- User list will be loaded here -->
          </div>
        </div>

        <!-- Maintenance Mode -->
        <div class="dev-section">
          <h3><i class="fas fa-tools"></i> Maintenance Mode</h3>
          <button class="dev-action-btn dev-action-btn-warning" id="maintenanceText" onclick="toggleMaintenance()">
            <i class="fas fa-toggle-off"></i> Enable Maintenance
          </button>
        </div>

        <!-- Database Management -->
        <div class="dev-section">
          <h3><i class="fas fa-database"></i> Database Management</h3>
          <button class="dev-action-btn dev-action-btn-danger" onclick="wipeAllUsers()">
            <i class="fas fa-broom"></i> Wipe All Users
          </button>
          <p style="color: #ef4444; font-size: 0.85rem; margin-top: 0.5rem;"> This will delete all user accounts (except dev@atlasfn.com)</p>
        </div>

        <!-- Owner Panel Access -->
        <div class="dev-section">
          <h3><i class="fas fa-crown"></i> Owner Controls</h3>
          <button class="dev-action-btn dev-action-btn-danger" onclick="openOwnerPanel()">
            <i class="fas fa-lock"></i> Open Owner Panel
          </button>
          <button class="dev-action-btn dev-action-btn-info" onclick="enterTestMode()">
            <i class="fas fa-user"></i> Test As Normal User
          </button>
        </div>
      </div>

      <button class="close-staff-btn" onclick="closeDevPanel()">Close Panel</button>
    </div>
  </div>

  <!-- Owner Panel (Dev Only) -->
  <div class="head-staff-panel" id="ownerPanel">
    <div class="head-staff-panel-content panel-shell panel-shell-owner">
      <div class="panel-header">
        <div class="panel-header-left">
          <img src="atlas_logo.png" class="panel-logo" alt="Atlasfn Logo" onerror="handleLogoError(this)">
          <div>
            <h2 class="panel-title"><i class="fas fa-crown"></i> Owner Control Panel</h2>
            <p class="panel-subtitle">Executive oversight and visibility controls</p>
          </div>
        </div>
        <span class="panel-role panel-role-owner">Owner</span>
      </div>
      <div class="panel-perms">
        <span class="panel-perm"><i class="fas fa-eye"></i> Full visibility</span>
        <span class="panel-perm"><i class="fas fa-users"></i> User oversight</span>
        <span class="panel-perm"><i class="fas fa-shield-alt"></i> Security review</span>
      </div>
      <div id="owner-message" class="panel-message"></div>
      
      <div class="staff-stats">
        <div class="stat-card" style="border-color: #ff6b00; background: rgba(255, 107, 0, 0.1);">
          <h3 id="owner-total-users" style="color: #ff6b00;">0</h3>
          <p>Total Users</p>
        </div>
        <div class="stat-card" style="border-color: #ff6b00; background: rgba(255, 107, 0, 0.1);">
          <h3 id="owner-active-users" style="color: #ff6b00;">0</h3>
          <p>Active Users</p>
        </div>
        <div class="stat-card" style="border-color: #ff6b00; background: rgba(255, 107, 0, 0.1);">
          <h3 id="owner-staff-count" style="color: #ff6b00;">0</h3>
          <p>Staff Members</p>
        </div>
        <div class="stat-card" style="border-color: #ff6b00; background: rgba(255, 107, 0, 0.1);">
          <h3 id="owner-dev-count" style="color: #ff6b00;">0</h3>
          <p>Developers</p>
        </div>
      </div>

      <div class="users-list">
        <h3><i class="fas fa-users"></i> Quick User Management</h3>
        <div id="owner-users-container" style="margin-top: 1rem;">
          <!-- Users will be dynamically loaded here -->
        </div>
      </div>

      <button class="close-staff-btn" onclick="closeOwnerPanel()">Close Panel</button>
    </div>
  </div>

  <!-- Head Staff Panel -->
  <div class="head-staff-panel" id="headStaffPanel">
    <div class="head-staff-panel-content panel-shell panel-shell-head">
      <div class="panel-header">
        <div class="panel-header-left">
          <img src="atlas_logo.png" class="panel-logo" alt="Atlasfn Logo" onerror="handleLogoError(this)">
          <div>
            <h2 class="panel-title"><i class="fas fa-crown"></i> Head Staff Control Panel</h2>
            <p class="panel-subtitle">Moderation, escalations, and enforcement tools</p>
          </div>
        </div>
        <span class="panel-role panel-role-head">Head Staff</span>
      </div>
      <div class="panel-perms">
        <span class="panel-perm"><i class="fas fa-user-check"></i> Promote staff</span>
        <span class="panel-perm"><i class="fas fa-ban"></i> Blacklist users</span>
        <span class="panel-perm"><i class="fas fa-plug"></i> API bans</span>
        <span class="panel-perm"><i class="fas fa-clock"></i> Timeouts</span>
      </div>
      <div id="head-staff-message" class="panel-message"></div>
      
      <div class="staff-stats">
        <div class="stat-card">
          <h3 id="head-stat-total-users">0</h3>
          <p>Total Users</p>
        </div>
        <div class="stat-card">
          <h3 id="head-stat-active-users">0</h3>
          <p>Active Users</p>
        </div>
        <div class="stat-card">
          <h3 id="head-stat-blacklisted">0</h3>
          <p>Blacklisted</p>
        </div>
        <div class="stat-card">
          <h3 id="head-stat-timed-out">0</h3>
          <p>Timed Out</p>
        </div>
      </div>

      <div class="panel-block">
        <h3><i class="fas fa-plug"></i> API Moderation</h3>
        <input type="email" id="head-api-email" class="panel-input" placeholder="Enter user email">
        <button class="action-btn action-btn-blacklist" onclick="apiBanFromHead()">
          <i class="fas fa-ban"></i> API Ban User
        </button>
        <button class="action-btn action-btn-restore" onclick="viewAPIBansFromHead()">
          <i class="fas fa-list"></i> View API Bans
        </button>
        <div id="head-api-bans" class="ban-list"></div>
      </div>

      <div class="users-list">
        <h3><i class="fas fa-users"></i> User Management</h3>
        <div id="head-users-container">
          <!-- Users will be dynamically loaded here -->
        </div>
      </div>

      <button class="close-staff-btn" onclick="closeHeadStaffPanel()">Close Panel</button>
    </div>
  </div>

  <!-- Staff Panel -->
  <div class="staff-panel" id="staffPanel">
    <div class="staff-panel-content panel-shell panel-shell-staff">
      <div class="panel-header">
        <div class="panel-header-left">
          <img src="atlas_logo.png" class="panel-logo" alt="Atlasfn Logo" onerror="handleLogoError(this)">
          <div>
            <h2 class="panel-title"><i class="fas fa-shield-alt"></i> Staff Control Panel</h2>
            <p class="panel-subtitle">Daily moderation tools and user safety controls</p>
          </div>
        </div>
        <span class="panel-role panel-role-staff">Staff</span>
      </div>
      <div class="panel-perms">
        <span class="panel-perm"><i class="fas fa-clock"></i> Timeout users</span>
        <span class="panel-perm"><i class="fas fa-flag"></i> Ban requests</span>
        <span class="panel-perm"><i class="fas fa-users"></i> User overview</span>
      </div>
      <div id="staff-message" class="panel-message"></div>
      
      <div class="staff-stats">
        <div class="stat-card">
          <h3 id="stat-total-users">0</h3>
          <p>Total Users</p>
        </div>
        <div class="stat-card">
          <h3 id="stat-active-users">0</h3>
          <p>Active Users</p>
        </div>
        <div class="stat-card">
          <h3 id="stat-blacklisted">0</h3>
          <p>Blacklisted</p>
        </div>
        <div class="stat-card">
          <h3 id="stat-timed-out">0</h3>
          <p>Timed Out</p>
        </div>
      </div>

      <div class="users-list">
        <h3><i class="fas fa-users"></i> User Management</h3>
        <div class="panel-controls">
          <label for="staff-timeout-duration" style="color: #aaa; font-size: 0.85rem;">Timeout duration</label>
          <select id="staff-timeout-duration" class="panel-select">
            <option value="30">30 min</option>
            <option value="60">1 hr</option>
            <option value="300">5 hr</option>
            <option value="1440">24 hr</option>
            <option value="2880">48 hr</option>
            <option value="10080">1 week</option>
          </select>
        </div>
        <div id="users-container">
          <!-- Users will be dynamically loaded here -->
        </div>
      </div>

      <button class="close-staff-btn" onclick="closeStaffPanel()">Close Panel</button>
    </div>
  </div>

  <!-- Signup Modal -->
  <div class="auth-modal" id="signupModal">
    <div class="auth-modal-content">
      <h2><i class="fas fa-user-plus"></i> Sign Up</h2>
      <div class="auth-error" id="signupError"></div>
      <div class="form-group">
        <label>Full Name <span style="color: #888; font-weight: normal;">(optional)</span></label>
        <input type="text" id="signupName" placeholder="Your Name">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="signupEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="signupPassword" placeholder="Min 8 chars: 1 uppercase, 1 lowercase, 1 number">
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" id="signupConfirm" placeholder="Confirm Password">
      </div>
      <button class="auth-modal-btn" onclick="handleSignup()">Create Account</button>
      <div class="auth-modal-toggle">
        Already have an account? <a onclick="switchToLogin()">Log In</a>
      </div>
      <button class="auth-modal-btn" style="background: transparent; border: 1px solid var(--border); color: var(--text); margin-top: 1rem;" onclick="closeModal('signupModal')">Cancel</button>
    </div>
  </div>

  <!-- Product Detail Modal -->
  <div class="product-detail-modal" id="productDetailModal">
    <div class="product-detail-content">
      <div class="product-detail-close" onclick="closeProductDetail()"></div>
      
      <div class="product-detail-header">
        <div class="product-detail-image" id="modalProductImage">
          <i class="fas fa-key"></i>
        </div>
        
        <div class="product-detail-info">
          <span class="product-detail-badge" id="modalProductBadge">In Stock</span>
          <h2 class="product-detail-title" id="modalProductTitle">Access Key</h2>
          <div class="product-detail-price" id="modalProductPrice">$3.99</div>
          <p class="product-detail-desc" id="modalProductDesc">Get instant access to all Atlas FN features.</p>
        </div>
      </div>

      <div class="product-detail-body">
        <div class="product-variants">
          <h4>Select Variant</h4>
          <div class="variant-grid" id="variantGrid">
            <!-- Variants will be inserted here dynamically -->
          </div>
        </div>

        <div class="product-quantity">
          <h4>Quantity</h4>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="decreaseQuantity()"></button>
            <span class="quantity-display" id="quantityDisplay">1</span>
            <button class="quantity-btn" onclick="increaseQuantity()">+</button>
          </div>
        </div>

        <div class="product-actions">
          <button class="btn-add-cart" onclick="addToCart()">
            <i class="fas fa-shopping-cart"></i> Add to Cart
          </button>
          <button class="btn-buy-now" onclick="buyNow()">
            <i class="fas fa-bolt"></i> Buy Now
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order History Modal -->
  <div class="modern-modal" id="orderHistoryModal">
    <div class="modern-modal-content">
      <div class="modern-modal-header">
        <h2><i class="fas fa-shopping-bag"></i> Order History</h2>
        <button class="modern-modal-close" onclick="closeOrderHistory()"></button>
      </div>
      <div class="modern-modal-body" id="orderHistoryContent">
        <p style="text-align: center; color: #888; padding: 2rem;">No orders yet. Make your first purchase!</p>
      </div>
    </div>
  </div>

  <!-- Support/Tickets Modal -->
  <div class="modern-modal" id="supportModal">
    <div class="modern-modal-content">
      <div class="modern-modal-header">
        <h2><i class="fas fa-headset"></i> Support Center</h2>
        <button class="modern-modal-close" onclick="closeSupport()"></button>
      </div>
      <div class="modern-modal-tabs">
        <button class="modal-tab active" onclick="switchSupportTab('tickets')">My Tickets</button>
        <button class="modal-tab" onclick="switchSupportTab('new')">Create Ticket</button>
      </div>
      <div class="modern-modal-body">
        <div id="ticketsTab" class="support-tab-content active">
          <div id="ticketsList">
            <p style="text-align: center; color: #888; padding: 2rem;">No tickets yet.</p>
          </div>
        </div>
        <div id="newTicketTab" class="support-tab-content">
          <form id="newTicketForm" onsubmit="createTicket(event)">
            <div class="form-group">
              <label>Subject</label>
              <input type="text" id="ticketSubject" placeholder="Brief description of your issue" required>
            </div>
            <div class="form-group">
              <label>Priority</label>
              <select id="ticketPriority" style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: #0a0a0c; color: var(--text);">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <div class="form-group">
              <label>Message</label>
              <textarea id="ticketMessage" rows="5" placeholder="Describe your issue in detail..." required style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: #0a0a0c; color: var(--text); resize: vertical;"></textarea>
            </div>
            <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem; border: none; border-radius: 10px; background: linear-gradient(135deg, var(--accent), #a855f7); color: #000; font-weight: 700; cursor: pointer;">
              <i class="fas fa-paper-plane"></i> Submit Ticket
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <section class="hero">
    <h1>Access Keys.<br>Fast, Secure Checkout.</h1>
    <p>Choose your access duration and complete checkout securely in minutes.</p>
  </section>

  <div class="container">
    <div class="payment-section" id="store-section">
      <h2>Access Key Store</h2>
      <p>Select your access duration and checkout securely.</p>

      <div class="payment-container" id="store-cards">
        <div class="product-card" onclick="openProductDetail('1_day')">
          <div class="product-card-badge">In Stock</div>
          <div class="product-card-image">
            <i class="fas fa-key"></i>
          </div>
          <h3 class="product-card-title">1 Day Access</h3>
          <div class="product-card-price">$3.99</div>
          <p class="product-card-desc">24-hour access to Atlas FN</p>
        </div>

        <div class="product-card" onclick="openProductDetail('1_week')">
          <div class="product-card-badge">In Stock</div>
          <div class="product-card-image">
            <i class="fas fa-key"></i>
          </div>
          <h3 class="product-card-title">1 Week Access</h3>
          <div class="product-card-price">$9.99</div>
          <p class="product-card-desc">7 days of unrestricted access</p>
        </div>

        <div class="product-card" onclick="openProductDetail('1_month')">
          <div class="product-card-badge">In Stock</div>
          <div class="product-card-image">
            <i class="fas fa-key"></i>
          </div>
          <h3 class="product-card-title">1 Month Access</h3>
          <div class="product-card-price">$19.99</div>
          <p class="product-card-desc">30 days of full features</p>
        </div>

        <div class="product-card" onclick="openProductDetail('3_months')">
          <div class="product-card-badge">Popular</div>
          <div class="product-card-image">
            <i class="fas fa-crown"></i>
          </div>
          <h3 class="product-card-title">3 Months Access</h3>
          <div class="product-card-price">$39.99</div>
          <p class="product-card-desc">90 days of premium access</p>
        </div>

        <div class="product-card" onclick="openProductDetail('lifetime')">
          <div class="product-card-badge">Best Value</div>
          <div class="product-card-image">
            <i class="fas fa-star"></i>
          </div>
          <h3 class="product-card-title">Lifetime Access</h3>
          <div class="product-card-price">$99.99</div>
          <p class="product-card-desc">Unlimited access forever</p>
        </div>
      </div>

      <div class="payment-form-container" id="store-view" style="display: none;">
        <h3 style="margin-bottom: 1.5rem; color: var(--accent);">Choose Access Duration</h3>

        <div class="form-group">
          <label for="access-duration">Access Length <span style="color: #ff6b6b;">*</span></label>
          <select id="access-duration" required style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: #0a0a0c; color: var(--text); font-size: 1rem;">
            <option value="1_day">1 day - $3.99</option>
            <option value="1_week">1 week - $9.99</option>
            <option value="1_month">1 month - $19.99</option>
            <option value="3_months">3 months - $39.99</option>
            <option value="lifetime">Lifetime - $99.99</option>
          </select>
        </div>

        <div class="form-group">
          <label for="access-amount">Price (USD) <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="access-amount" readonly>
        </div>

        <h4 style="margin: 2rem 0 1rem; color: var(--text); font-size: 1.1rem;">Contact Details</h4>

        <div class="form-group">
          <label for="donor-name">Full Name <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="donor-name" placeholder="John Doe" required>
        </div>

        <div class="form-group">
          <label for="donor-email">Email Address <span style="color: #ff6b6b;">*</span></label>
          <input type="email" id="donor-email" placeholder="your@email.com" required>
        </div>

        <div class="form-group">
          <label for="donor-phone">Phone Number <span style="color: #888; font-weight: normal;">(optional)</span></label>
          <input type="tel" id="donor-phone" placeholder="+1 (555) 123-4567">
        </div>

        <h4 style="margin: 2rem 0 1rem; color: var(--text); font-size: 1.1rem;">Billing Address</h4>

        <div class="form-group">
          <label for="donor-address">Street Address <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="donor-address" placeholder="123 Main Street" required>
        </div>

        <div class="form-group">
          <label for="donor-city">City <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="donor-city" placeholder="New York" required>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label for="donor-state">State/Province <span style="color: #ff6b6b;">*</span></label>
            <input type="text" id="donor-state" placeholder="NY" required>
          </div>

          <div class="form-group">
            <label for="donor-zip">Zip/Postal Code <span style="color: #ff6b6b;">*</span></label>
            <input type="text" id="donor-zip" placeholder="10001" required>
          </div>
        </div>

        <div class="form-group">
          <label for="donor-country">Country <span style="color: #ff6b6b;">*</span></label>
          <select id="donor-country" required style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: #0a0a0c; color: var(--text); font-size: 1rem;">
            <option value="US">United States</option>
            <option value="CA">Canada</option>
            <option value="GB">United Kingdom</option>
            <option value="AU">Australia</option>
            <option value="DE">Germany</option>
            <option value="FR">France</option>
            <option value="IT">Italy</option>
            <option value="ES">Spain</option>
            <option value="MX">Mexico</option>
            <option value="BR">Brazil</option>
            <option value="JP">Japan</option>
            <option value="CN">China</option>
            <option value="IN">India</option>
            <option value="OTHER">Other</option>
          </select>
        </div>

        <h4 style="margin: 2rem 0 1rem; color: var(--text); font-size: 1.1rem;">Payment Method</h4>

        <div class="form-group">
          <label for="card-element">Card Details <span style="color: #ff6b6b;">*</span></label>
          <div id="card-element"></div>
          <p style="font-size: 0.85rem; color: #888; margin-top: 0.5rem;">
            <i class="fas fa-lock"></i> Secure payment powered by Stripe
          </p>
        </div>

        <button id="pay-button" class="btn-pay" style="width: 100%;">
          <i class="fas fa-credit-card"></i> Purchase Access Key
        </button>
        <div id="payment-message" style="margin-top: 1rem; color: #aaa;"></div>
        
        <p style="font-size: 0.8rem; color: #666; margin-top: 1rem; text-align: center;">
          <span style="color: #ff6b6b;">*</span> Required fields
        </p>
      </div>
    </div>
  </div>

  <section class="faq-section" id="faq">
    <div class="container">
      <h2>FAQ</h2>
      <p class="section-intro">Common store, account, and access questions.</p>
      <div class="faq-grid">
        <div class="faq-item">
          <h3>Do I need to create an account to purchase?</h3>
          <p>No! You can checkout as a guest. Creating an account is optional and provides benefits like order history and faster future purchases.</p>
        </div>
        <div class="faq-item">
          <h3>My payment failed. What should I do?</h3>
          <p>Verify your card details, billing address, and available balance. Try again or use a different card.</p>
        </div>
        <div class="faq-item">
          <h3>I was charged but didnt receive an access key.</h3>
          <p>Check your email inbox and spam folder. If you still dont see it, contact support with your receipt email.</p>
        </div>
        <div class="faq-item">
          <h3>My access key says invalid.</h3>
          <p>Copy and paste the key exactly and avoid extra spaces. If it still fails, reset your key from your account page.</p>
        </div>
        <div class="faq-item">
          <h3>Can I change the email tied to my key?</h3>
          <p>Yes. Update your account email first, then request a key reissue from the store page.</p>
        </div>
        <div class="faq-item">
          <h3>I cant log in.</h3>
          <p>Confirm your email and password. If you forgot your password, use the reset flow or contact support.</p>
        </div>
        <div class="faq-item">
          <h3>Why am I not receiving verification emails?</h3>
          <p>Check spam and promotions folders, and make sure your email provider isnt blocking automated mail.</p>
        </div>
        <div class="faq-item">
          <h3>Can I upgrade my access duration?</h3>
          <p>Yes. Purchase the new duration and the system will extend your access time automatically.</p>
        </div>
        <div class="faq-item">
          <h3>Is my payment information stored here?</h3>
          <p>No. Payments are processed securely by Stripe. We never store your card details.</p>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="footer-links">
      <a href="#">Terms of Service</a>
      <a href="#">Privacy Policy</a>
      <a href="#">Contact</a>
      <a href="#">API Docs</a>
      <a href="#">Status</a>
    </div>
    <p style="color:#555; font-size:0.9rem;">&copy; 2026 Atlasfn. All rights reserved. Secure payments powered by Stripe.</p>
  </footer>

  <div id="global-toast"></div>
  <div id="ban-banner" class="ban-banner"></div>
  <div id="testModeBanner" class="test-mode-banner">
    <span>Test mode active (normal user)</span>
    <button type="button" onclick="exitTestMode()">Exit Test Mode</button>
  </div>
  <div id="privacyOverlay" class="privacy-overlay">
    <div class="privacy-overlay-content">
      <h3>Protected View</h3>
      <p id="privacyMessage">This page is protected. Please close developer tools and refresh.</p>
    </div>
  </div>

  <div class="action-modal" id="actionModal">
    <div class="action-modal-content">
      <h3 id="actionModalTitle">Confirm Action</h3>
      <p id="actionModalMessage"></p>
      <div class="action-modal-actions">
        <button class="modal-cancel" type="button" onclick="closeActionModal()">Cancel</button>
        <button class="modal-confirm" type="button" id="actionModalConfirm">Confirm</button>
      </div>
    </div>
  </div>

  <div class="action-modal" id="banRequestModal">
    <div class="action-modal-content">
      <h3 id="banRequestTitle">Ban Request</h3>
      <p id="banRequestTarget"></p>
      <div class="form-group" style="margin-top: 1rem;">
        <label for="banRequestReason">Reason (required)</label>
        <textarea id="banRequestReason" rows="4" style="width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; background: #0a0a0c; color: var(--text); font-size: 0.95rem; resize: vertical;" placeholder="Describe what the user did..."></textarea>
      </div>
      <div class="action-modal-actions">
        <button class="modal-cancel" type="button" onclick="closeBanRequestModal()">Cancel</button>
        <button class="modal-confirm warning" type="button" onclick="submitBanRequest()">Send Request</button>
      </div>
    </div>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    // Initialize Stripe with your public key
    let stripe = null;
    let elements = null;
    let cardElement = null;

    // Helper function to get API base URL (works locally and on production)
    function getApiBaseUrl() {
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return `http://${window.location.hostname}:3000`;
      }
      // Use same domain as website for production
      return `${window.location.protocol}//${window.location.hostname}`;
    }

    const API_BASE_URL = getApiBaseUrl();

    if (window.Stripe) {
      stripe = Stripe('pk_test_51T2ZQNC82zYZrre5zfZCJEf74Bu3iP3ZshvGjYlUAFeCTWV7l6IH7XoXgDksxRyBABYhWd9ejawPYjlZ02UKHgqw00hVTEL64A');
      elements = stripe.elements({
        fonts: [
          {
            cssSrc: 'https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap'
          }
        ],
        locale: 'en'
      });

      cardElement = elements.create('card', {
        style: {
          base: {
            fontSize: '16px',
            color: '#e0e0e0',
            fontFamily: 'Space Grotesk, system-ui, sans-serif',
            '::placeholder': {
              color: '#666666'
            }
          },
          invalid: {
            color: '#ff6b6b'
          }
        },
        hidePostalCode: false
      });
      cardElement.mount('#card-element');
    } else {
      const payButton = document.getElementById('pay-button');
      if (payButton) {
        payButton.disabled = true;
        payButton.textContent = 'Payments unavailable';
      }
    }

    // ====== LANDING PAGE FUNCTIONS ======

    function checkLandingPageAuth() {
      const currentUser = localStorage.getItem('currentUser');
      const landingPage = document.getElementById('landingPage');
      const landingLoggedIn = document.getElementById('landingLoggedIn');
      const landingLoggedOut = document.getElementById('landingLoggedOut');
      
      if (currentUser) {
        landingLoggedIn.style.display = 'block';
        landingLoggedOut.style.display = 'none';
      } else {
        landingLoggedIn.style.display = 'none';
        landingLoggedOut.style.display = 'block';
      }
    }

    function goToStore() {
      const landingPage = document.getElementById('landingPage');
      landingPage.classList.add('hidden');
      setTimeout(() => {
        document.getElementById('store-section').scrollIntoView({ behavior: 'smooth' });
      }, 500);
    }

    function openLoginFromLanding() {
      window.open('login.html', '_blank');
    }

    function openSignupFromLanding() {
      window.open('signup.html', '_blank');
    }

    // Initialize landing page on load
    window.addEventListener('DOMContentLoaded', () => {
      // Landing page disabled - skip checkLandingPageAuth();
      const accessSelect = document.getElementById('access-duration');
      if (accessSelect) {
        updateAccessPrice();
        accessSelect.addEventListener('change', updateAccessPrice);
      }
    });

    const accessKeyPricing = {
      '1_day': { label: '1 day', price: 3.99, desc: '24-hour access to all Atlas FN features', badge: 'In Stock', icon: 'fa-key' },
      '1_week': { label: '1 week', price: 9.99, desc: '7 days of unrestricted access to all features', badge: 'In Stock', icon: 'fa-key' },
      '1_month': { label: '1 month', price: 19.99, desc: '30 days of full access with premium support', badge: 'In Stock', icon: 'fa-key' },
      '3_months': { label: '3 months', price: 39.99, desc: '90 days of premium access with priority updates', badge: 'Popular', icon: 'fa-crown' },
      'lifetime': { label: 'lifetime', price: 99.99, desc: 'Unlimited access forever with all future updates', badge: 'Best Value', icon: 'fa-star' }
    };

    // Product Detail Modal Logic
    let selectedProductKey = '1_day';
    let selectedVariant = '1_day';
    let productQuantity = 1;

    function openProductDetail(productKey) {
      selectedProductKey = productKey;
      selectedVariant = productKey;
      productQuantity = 1;

      const product = accessKeyPricing[productKey];
      if (!product) return;

      // Update modal content
      document.getElementById('modalProductTitle').textContent = product.label.charAt(0).toUpperCase() + product.label.slice(1) + ' Access';
      document.getElementById('modalProductPrice').textContent = '$' + product.price.toFixed(2);
      document.getElementById('modalProductDesc').textContent = product.desc;
      document.getElementById('modalProductBadge').textContent = product.badge;
      document.getElementById('modalProductImage').innerHTML = '<i class="fas ' + product.icon + '"></i>';
      document.getElementById('quantityDisplay').textContent = productQuantity;

      // Build variant grid
      const variantGrid = document.getElementById('variantGrid');
      variantGrid.innerHTML = '';

      Object.keys(accessKeyPricing).forEach(key => {
        const variant = accessKeyPricing[key];
        const variantDiv = document.createElement('div');
        variantDiv.className = 'variant-option' + (key === selectedVariant ? ' selected' : '');
        variantDiv.onclick = () => selectVariant(key);
        variantDiv.innerHTML = `
          <div class="variant-label">${variant.label}</div>
          <div class="variant-price">$${variant.price.toFixed(2)}</div>
        `;
        variantGrid.appendChild(variantDiv);
      });

      // Show modal
      document.getElementById('productDetailModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeProductDetail() {
      document.getElementById('productDetailModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function selectVariant(variantKey) {
      selectedVariant = variantKey;
      const variant = accessKeyPricing[variantKey];
      
      // Update selected state
      document.querySelectorAll('.variant-option').forEach(option => {
        option.classList.remove('selected');
      });
      event.target.closest('.variant-option').classList.add('selected');

      // Update price
      document.getElementById('modalProductPrice').textContent = '$' + variant.price.toFixed(2);
    }

    function increaseQuantity() {
      if (productQuantity < 99) {
        productQuantity++;
        document.getElementById('quantityDisplay').textContent = productQuantity;
      }
    }

    function decreaseQuantity() {
      if (productQuantity > 1) {
        productQuantity--;
        document.getElementById('quantityDisplay').textContent = productQuantity;
      }
    }

    function addToCart() {
      // For now, just show a toast notification
      showToast('Added to cart! (Cart feature coming soon)', 'success');
      closeProductDetail();
    }

    function buyNow() {
      // Set the selected access duration and open checkout
      const accessSelect = document.getElementById('access-duration');
      if (accessSelect) {
        accessSelect.value = selectedVariant;
        updateAccessPrice();
      }

      closeProductDetail();

      // Show the payment form
      const storeView = document.getElementById('store-view');
      if (storeView) {
        storeView.style.display = 'block';
        setTimeout(() => {
          storeView.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    }

    function updateAccessPrice() {
      const select = document.getElementById('access-duration');
      const amountInput = document.getElementById('access-amount');
      if (!select || !amountInput) return;

      const selected = accessKeyPricing[select.value];
      if (!selected) return;

      amountInput.value = selected.price.toFixed(2);
    }

    function openStoreView() {
      const storeView = document.getElementById('store-view');
      if (!storeView) return;

      storeView.scrollIntoView({ behavior: 'smooth', block: 'center' });
      const select = document.getElementById('access-duration');
      if (select) {
        select.focus();
      }
    }

    document.getElementById('pay-button').addEventListener('click', async (e) => {
      e.preventDefault();

      if (!stripe || !cardElement) {
        const messageDiv = document.getElementById('payment-message');
        if (messageDiv) {
          messageDiv.textContent = ' Payments are unavailable right now.';
          messageDiv.style.color = '#ff6b6b';
        }
        return;
      }
      
      // Get all form values
      const accessSelect = document.getElementById('access-duration');
      const accessChoice = accessSelect ? accessSelect.value : '';
      const accessInfo = accessKeyPricing[accessChoice];
      const amount = accessInfo ? accessInfo.price : NaN;
      const name = document.getElementById('donor-name').value.trim();
      const email = document.getElementById('donor-email').value.trim();
      const phone = document.getElementById('donor-phone').value.trim();
      const address = document.getElementById('donor-address').value.trim();
      const city = document.getElementById('donor-city').value.trim();
      const state = document.getElementById('donor-state').value.trim();
      const zip = document.getElementById('donor-zip').value.trim();
      const country = document.getElementById('donor-country').value;
      const messageDiv = document.getElementById('payment-message');

      // Validation
      if (!accessInfo || !amount || amount < 1) {
        messageDiv.textContent = ' Please select a valid access duration';
        messageDiv.style.color = '#ff6b6b';
        if (accessSelect) {
          accessSelect.focus();
        }
        return;
      }

      if (!name) {
        messageDiv.textContent = ' Please enter your full name';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-name').focus();
        return;
      }

      if (!email) {
        messageDiv.textContent = ' Please enter your email address';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-email').focus();
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        messageDiv.textContent = ' Please enter a valid email address';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-email').focus();
        return;
      }

      // Phone is now optional, no validation needed

      if (!address) {
        messageDiv.textContent = ' Please enter your street address';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-address').focus();
        return;
      }

      if (!city) {
        messageDiv.textContent = ' Please enter your city';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-city').focus();
        return;
      }

      if (!state) {
        messageDiv.textContent = ' Please enter your state/province';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-state').focus();
        return;
      }

      if (!zip) {
        messageDiv.textContent = ' Please enter your zip/postal code';
        messageDiv.style.color = '#ff6b6b';
        document.getElementById('donor-zip').focus();
        return;
      }

      messageDiv.textContent = ' Processing payment...';
      messageDiv.style.color = '#00d4ff';

      // Call your backend to create a payment intent
      const response = await fetch(`${API_BASE_URL}/create-payment-intent`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: Math.round(amount * 100), // Convert to cents
          email: email,
          name: name,
          phone: phone,
          address: {
            line1: address,
            city: city,
            state: state,
            postal_code: zip,
            country: country
          }
        })
      }).catch(err => {
        messageDiv.textContent = ' Error: Make sure your Flask server is running (python server/server.py)';
        messageDiv.style.color = '#ff6b6b';
        return null;
      });

      if (!response) return;

      const data = await response.json();

      if (data.error) {
        messageDiv.textContent = ` ${data.error}`;
        messageDiv.style.color = '#ff6b6b';
        return;
      }

      // Confirm payment with Stripe
      const result = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: {
          card: cardElement,
          billing_details: {
            name: name,
            email: email,
            phone: phone,
            address: {
              line1: address,
              city: city,
              state: state,
              postal_code: zip,
              country: country
            }
          }
        }
      });

      if (result.error) {
        messageDiv.textContent = ` ${result.error.message}`;
        messageDiv.style.color = '#ff6b6b';
      } else {
        messageDiv.textContent = ` Payment successful! Access key activated for ${accessInfo.label}.`;
        messageDiv.style.color = '#00ff88';
        
        // Save order to localStorage
        const order = {
          date: Date.now(),
          product: accessInfo.label,
          amount: accessInfo.price,
          status: 'completed',
          email: email,
          name: name
        };
        
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        orders.push(order);
        localStorage.setItem('orders', JSON.stringify(orders));
        
        // Clear form
        if (accessSelect) {
          accessSelect.value = '1_day';
        }
        updateAccessPrice();
        document.getElementById('donor-name').value = '';
        document.getElementById('donor-email').value = '';
        document.getElementById('donor-phone').value = '';
        document.getElementById('donor-address').value = '';
        document.getElementById('donor-city').value = '';
        document.getElementById('donor-state').value = '';
        document.getElementById('donor-zip').value = '';
        document.getElementById('donor-country').value = 'US';
        cardElement.clear();
        
        // Scroll to success message
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });

    // Real-time card validation
    if (cardElement) {
      cardElement.addEventListener('change', (event) => {
        const displayError = document.getElementById('payment-message');
        if (event.error) {
          displayError.textContent = event.error.message;
          displayError.style.color = '#ff6b6b';
        } else {
          displayError.textContent = '';
        }
      });
    }

    // ====== AUTHENTICATION FUNCTIONS ======

    // Security: Simple XSS prevention
    function sanitizeInput(input) {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    }

    let actionModalHandler = null;
    let banRequestTarget = null;
    let focusedBanRequestId = null;

    const privacyConfig = {
      blockContextMenu: true,
      blockSelection: true,
      blockHotkeys: true,
      devtoolsOverlay: true,
      integrityCheck: true
    };

    function isDevUser() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!currentUser) return false;
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id || u.email === currentUser.email);
      return user && user.isDev;
    }

    function showPrivacyOverlay(message) {
      if (isDevUser()) return;
      const overlay = document.getElementById('privacyOverlay');
      const messageEl = document.getElementById('privacyMessage');
      if (!overlay) return;

      if (messageEl && message) {
        messageEl.textContent = message;
      }

      overlay.classList.add('active');
    }

    function setupPrivacyGuards() {
      if (privacyConfig.blockContextMenu) {
        document.addEventListener('contextmenu', (event) => {
          if (isDevUser()) return;
          event.preventDefault();
        });
      }

      if (privacyConfig.blockSelection) {
        document.addEventListener('selectstart', (event) => {
          if (isDevUser()) return;
          if (event.target && event.target.closest && event.target.closest('input, textarea')) {
            return;
          }
          event.preventDefault();
        });

        document.addEventListener('dragstart', (event) => {
          if (isDevUser()) return;
          event.preventDefault();
        });
      }

      if (privacyConfig.blockHotkeys) {
        document.addEventListener('keydown', (event) => {
          if (isDevUser()) return;
          const key = event.key.toLowerCase();
          const ctrl = event.ctrlKey || event.metaKey;
          const shift = event.shiftKey;

          if (key === 'f12' || (ctrl && shift && ['i', 'j', 'c'].includes(key)) || (ctrl && ['u', 's', 'p'].includes(key))) {
            event.preventDefault();
            event.stopPropagation();
            showPrivacyOverlay('This view is protected. Please close developer tools and refresh.');
          }
        }, true);
      }

      if (privacyConfig.devtoolsOverlay) {
        const threshold = 160;
        setInterval(() => {
          if (isDevUser()) return;
          const widthGap = window.outerWidth - window.innerWidth;
          const heightGap = window.outerHeight - window.innerHeight;
          if (widthGap > threshold || heightGap > threshold) {
            showPrivacyOverlay('Developer tools detected. Please close them to continue.');
          }
        }, 800);
      }

      if (privacyConfig.integrityCheck) {
        const baseline = {
          handleSignup: typeof handleSignup === 'function' ? handleSignup.toString() : '',
          handleLogin: typeof handleLogin === 'function' ? handleLogin.toString() : '',
          openDevPanel: typeof openDevPanel === 'function' ? openDevPanel.toString() : ''
        };

        setInterval(() => {
          if (isDevUser()) return;
          if (baseline.handleSignup !== (typeof handleSignup === 'function' ? handleSignup.toString() : '')) {
            showPrivacyOverlay('Integrity check failed. Please refresh.');
          }
          if (baseline.handleLogin !== (typeof handleLogin === 'function' ? handleLogin.toString() : '')) {
            showPrivacyOverlay('Integrity check failed. Please refresh.');
          }
          if (baseline.openDevPanel !== (typeof openDevPanel === 'function' ? openDevPanel.toString() : '')) {
            showPrivacyOverlay('Integrity check failed. Please refresh.');
          }
        }, 1200);
      }
    }


    function showToast(message, type = 'info') {
      const container = document.getElementById('global-toast');
      if (!container) return;

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3500);
    }

    let banBannerTimer = null;
    const banPhrases = [
      'bum ahh jit got banned',
      'got da boot',
      'adios amigo'
    ];

    function showUniversalBanMessage() {
      const banner = document.getElementById('ban-banner');
      if (!banner) return;

      const phrase = banPhrases[Math.floor(Math.random() * banPhrases.length)];
      banner.textContent = phrase;
      banner.classList.add('show');

      if (banBannerTimer) {
        clearTimeout(banBannerTimer);
      }

      banBannerTimer = setTimeout(() => {
        banner.classList.remove('show');
      }, 3200);
    }

    function getFallbackLogoDataUrl() {
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200">
          <defs>
            <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#d8b4fe;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#a855f7;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#581c87;stop-opacity:1" />
            </linearGradient>
          </defs>
          <!-- Left side of A -->
          <polygon points="50,170 100,30 100,170" fill="url(#purpleGrad)" />
          <!-- Right side of A -->
          <polygon points="100,170 150,30 150,170" fill="url(#purpleGrad)" opacity="0.85" />
          <!-- Horizontal bar -->
          <rect x="55" y="110" width="90" height="12" fill="url(#purpleGrad)" />
          <!-- Diagonal line cut -->
          <line x1="70" y1="115" x2="140" y2="165" stroke="rgba(255,255,255,0.25)" stroke-width="10" stroke-linecap="round" />
        </svg>
      `;
      return `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}`;
    }function handleLogoError(img) {
      if (img.getAttribute('data-fallback-applied')) return;
      const fallback = getFallbackLogoDataUrl();
      img.setAttribute('data-fallback-applied', 'true');
      img.onerror = null;
      img.src = fallback;
    }

    function setLogoBackground() {
      const logoUrl = 'atlas_logo.png';
      const fallback = getFallbackLogoDataUrl();
      const loader = new Image();

      loader.onload = () => {
        document.documentElement.style.setProperty('--logo-bg', `url('${logoUrl}')`);
      };

      loader.onerror = () => {
        document.documentElement.style.setProperty('--logo-bg', `url('${fallback}')`);
      };

      loader.src = logoUrl;
      
      // Fallback timeout in case the image load event doesn't fire
      setTimeout(() => {
        if (!document.documentElement.style.getPropertyValue('--logo-bg')) {
          document.documentElement.style.setProperty('--logo-bg', `url('${fallback}')`);
        }
      }, 1000);
    }

    function showPanelMessage(panelId, message, type = 'info') {
      const panel = document.getElementById(panelId);
      if (!panel) {
        showToast(message, type);
        return;
      }

      panel.textContent = message;
      panel.className = `panel-message ${type} show`;

      setTimeout(() => {
        panel.classList.remove('show');
      }, 3500);
    }

    function getDevNotifications() {
      return JSON.parse(localStorage.getItem('devNotifications') || '[]');
    }

    function setDevNotifications(notifications) {
      localStorage.setItem('devNotifications', JSON.stringify(notifications));
    }

    function addDevNotification({ message, type = 'ban-request', requestId }) {
      const notifications = getDevNotifications();
      notifications.unshift({
        id: Date.now(),
        type,
        message,
        requestId,
        read: false,
        createdAt: new Date().toISOString()
      });
      setDevNotifications(notifications);
      renderDevNotifications();
    }

    function renderDevNotifications() {
      const dropdown = document.getElementById('dev-notif-dropdown');
      const countEl = document.getElementById('dev-notif-count');
      if (!dropdown || !countEl) return;

      const notifications = getDevNotifications();
      const unreadCount = notifications.filter(n => !n.read).length;

      countEl.textContent = unreadCount;
      countEl.style.display = unreadCount > 0 ? 'flex' : 'none';

      if (notifications.length === 0) {
        dropdown.innerHTML = '<div class="notif-empty">No new notifications.</div>';
        return;
      }

      dropdown.innerHTML = notifications
        .slice(0, 6)
        .map(notification => `
          <div class="notif-item ${notification.read ? '' : 'unread'}" onclick="handleDevNotificationClick(${notification.id})">
            <div>${sanitizeInput(notification.message)}</div>
            <div class="notif-time">${new Date(notification.createdAt).toLocaleString()}</div>
          </div>
        `)
        .join('');
    }

    function toggleDevNotifications() {
      const dropdown = document.getElementById('dev-notif-dropdown');
      if (!dropdown) return;

      if (dropdown.classList.contains('open')) {
        dropdown.classList.remove('open');
        return;
      }

      renderDevNotifications();
      dropdown.classList.add('open');
    }

    function closeDevNotifications() {
      const dropdown = document.getElementById('dev-notif-dropdown');
      if (dropdown) dropdown.classList.remove('open');
    }

    function markAllDevNotificationsRead() {
      const notifications = getDevNotifications().map(notification => ({
        ...notification,
        read: true
      }));
      setDevNotifications(notifications);
      renderDevNotifications();
    }

    function handleDevNotificationClick(notificationId) {
      const notifications = getDevNotifications();
      const index = notifications.findIndex(n => n.id === notificationId);
      if (index !== -1) {
        notifications[index].read = true;
        focusedBanRequestId = notifications[index].requestId || null;
        setDevNotifications(notifications);
      }

      closeDevNotifications();
      openDevPanel();
    }

    function openActionModal({ title, message, confirmText = 'Confirm', confirmClass = '', onConfirm }) {
      const modal = document.getElementById('actionModal');
      const titleEl = document.getElementById('actionModalTitle');
      const messageEl = document.getElementById('actionModalMessage');
      const confirmBtn = document.getElementById('actionModalConfirm');

      titleEl.textContent = title || 'Confirm Action';
      messageEl.textContent = message || '';
      confirmBtn.textContent = confirmText;
      confirmBtn.className = `modal-confirm ${confirmClass}`.trim();

      actionModalHandler = onConfirm || null;
      modal.classList.add('active');
    }

    function closeActionModal() {
      const modal = document.getElementById('actionModal');
      modal.classList.remove('active');
      actionModalHandler = null;
    }

    function openBanRequestModal(targetUser) {
      const modal = document.getElementById('banRequestModal');
      const targetText = document.getElementById('banRequestTarget');
      const reasonInput = document.getElementById('banRequestReason');

      banRequestTarget = targetUser;
      targetText.textContent = `Requesting ban for ${targetUser.email}`;
      reasonInput.value = '';
      modal.classList.add('active');
      reasonInput.focus();
    }

    function openBanRequestModalById(userId, panelMessageId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const target = users.find(u => u.id === userId);

      if (!target) {
        showPanelMessage(panelMessageId, 'User not found.', 'error');
        return;
      }

      openBanRequestModal({
        id: target.id,
        email: target.email,
        panelMessageId
      });
    }

    function closeBanRequestModal() {
      const modal = document.getElementById('banRequestModal');
      modal.classList.remove('active');
      banRequestTarget = null;
    }

    function submitBanRequest() {
      if (!banRequestTarget) return;

      const reasonInput = document.getElementById('banRequestReason');
      const reason = reasonInput.value.trim();
      if (!reason) {
        showToast('Please provide a reason for the ban request.', 'error');
        reasonInput.focus();
        return;
      }

      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!currentUser) {
        showToast('You must be logged in to submit a request.', 'error');
        return;
      }

      const requests = JSON.parse(localStorage.getItem('banRequests') || '[]');
      requests.unshift({
        id: Date.now(),
        targetUserId: banRequestTarget.id,
        targetEmail: banRequestTarget.email,
        requestedById: currentUser.id,
        requestedByName: currentUser.name,
        requestedByEmail: currentUser.email,
        reason,
        status: 'pending',
        createdAt: new Date().toISOString()
      });

      localStorage.setItem('banRequests', JSON.stringify(requests));
      addDevNotification({
        message: `Ban request submitted for ${banRequestTarget.email}.`,
        requestId: requests[0].id
      });
      closeBanRequestModal();
      showPanelMessage(banRequestTarget.panelMessageId, 'Ban request sent to developers.', 'success');
      renderBanRequests();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const confirmBtn = document.getElementById('actionModalConfirm');
      if (confirmBtn) {
        confirmBtn.addEventListener('click', () => {
          if (typeof actionModalHandler === 'function') {
            actionModalHandler();
          }
          closeActionModal();
        });
      }

      document.addEventListener('click', (event) => {
        const wrapper = document.getElementById('dev-notif-wrapper');
        const dropdown = document.getElementById('dev-notif-dropdown');
        if (!wrapper || !dropdown || !dropdown.classList.contains('open')) return;

        if (!wrapper.contains(event.target)) {
          dropdown.classList.remove('open');
        }
      });
    });

    function getTimeoutDuration(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return null;

      const minutes = parseInt(select.value, 10);
      const labels = {
        30: '30 minutes',
        60: '1 hour',
        300: '5 hours',
        1440: '24 hours',
        2880: '48 hours',
        10080: '1 week'
      };

      if (!labels[minutes]) return null;
      return { minutes, label: labels[minutes] };
    }

    // Security: Basic password hashing (SHA-256)
    async function hashPassword(password) {
      try {
        if (typeof crypto !== 'undefined' && crypto.subtle) {
          const msgBuffer = new TextEncoder().encode(password);
          const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
      } catch (error) {
        // Fall through to basic hash for non-secure contexts.
      }

      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        hash = ((hash << 5) - hash) + password.charCodeAt(i);
        hash |= 0;
      }
      return Math.abs(hash).toString(16).padStart(8, '0');
    }

    // Security: Rate limiting for login attempts
    const loginAttempts = {};
    function checkRateLimit(email) {
      const now = Date.now();
      if (!loginAttempts[email]) {
        loginAttempts[email] = { count: 1, firstAttempt: now };
        return true;
      }
      
      // Reset after 15 minutes
      if (now - loginAttempts[email].firstAttempt > 900000) {
        loginAttempts[email] = { count: 1, firstAttempt: now };
        return true;
      }
      
      // Max 5 attempts per 15 minutes
      if (loginAttempts[email].count >= 5) {
        return false;
      }
      
      loginAttempts[email].count++;
      return true;
    }

    // Initialize default dev account
    async function initializeDevAccount() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      // Check if dev account already exists
      const devEmail = 'dev@atlasfn.com';
      const devExists = users.some(u => u.email === devEmail);
      
      if (!devExists) {
        // Create default dev account
        const devPassword = 'DevAdmin123';
        const hashedPassword = await hashPassword(devPassword);
        
        const devUser = {
          id: Date.now(),
          name: 'Developer',
          email: devEmail,
          password: hashedPassword,
          createdAt: new Date().toISOString(),
          isDev: true
        };
        
        users.push(devUser);
        localStorage.setItem('users', JSON.stringify(users));
        console.log(' Dev account created: dev@atlasfn.com / DevAdmin123');
      }
    }

    // Check if user is logged in on page load
    window.addEventListener('DOMContentLoaded', async () => {
      await initializeDevAccount();
      checkAccessRestrictions();
      setLogoBackground();
      setupPrivacyGuards();
      applyTestModeOnLoad();
      
      // Check if user is logged in and update UI accordingly
      const currentUser = localStorage.getItem('currentUser');
      if (currentUser) {
        updateNavBar(JSON.parse(currentUser));
      } else {
        // Show login/signup buttons when not logged in
        document.getElementById('nav-auth').style.display = 'flex';
        document.getElementById('user-menu').style.display = 'none';
      }
      
      // Landing page disabled - directly accessible
    });

    // ====== STAFF PANEL FUNCTIONS ======

    function checkAccessRestrictions() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!currentUser) return;

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id);

      if (!user) return;

      // Check if user is blacklisted
      if (user.blacklisted) {
        showToast('Your account has been blacklisted. Access denied.', 'error');
        localStorage.removeItem('currentUser');
        setTimeout(() => window.location.reload(), 600);
        return;
      }

      // Check if user is timed out
      if (user.timeoutUntil && new Date(user.timeoutUntil) > new Date()) {
        const timeLeft = Math.ceil((new Date(user.timeoutUntil) - new Date()) / 60000);
        showToast(`Your account is timed out. Access restored in ${timeLeft} minutes.`, 'error');
        localStorage.removeItem('currentUser');
        setTimeout(() => window.location.reload(), 600);
        return;
      }

      // Clear expired timeouts
      if (user.timeoutUntil && new Date(user.timeoutUntil) <= new Date()) {
        user.timeoutUntil = null;
        const userIndex = users.findIndex(u => u.id === user.id);
        users[userIndex] = user;
        localStorage.setItem('users', JSON.stringify(users));
      }
    }

    function openStaffPanel() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id);

      if (!user || !user.isStaff) {
        showToast('Access denied. Staff privileges required.', 'error');
        return;
      }

      document.getElementById('staffPanel').classList.add('active');
      loadStaffPanel();
    }

    function closeStaffPanel() {
      document.getElementById('staffPanel').classList.remove('active');
    }

    function loadStaffPanel() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const now = new Date();

      // Calculate stats
      const totalUsers = users.length;
      const activeUsers = users.filter(u => !u.blacklisted && (!u.timeoutUntil || new Date(u.timeoutUntil) <= now)).length;
      const blacklisted = users.filter(u => u.blacklisted).length;
      const timedOut = users.filter(u => u.timeoutUntil && new Date(u.timeoutUntil) > now).length;

      document.getElementById('stat-total-users').textContent = totalUsers;
      document.getElementById('stat-active-users').textContent = activeUsers;
      document.getElementById('stat-blacklisted').textContent = blacklisted;
      document.getElementById('stat-timed-out').textContent = timedOut;

      // Load users list
      const container = document.getElementById('users-container');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem;">No users registered yet.</p>';
        return;
      }

      users.forEach(user => {
        const isBlacklisted = user.blacklisted || false;
        const isTimedOut = user.timeoutUntil && new Date(user.timeoutUntil) > now;
        const isStaff = user.isStaff || false;
        const isHeadStaff = user.isHeadStaff || false;
        const isDev = user.isDev || false;
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const isSelf = user.id === currentUser.id;

        let statusClass = '';
        if (isBlacklisted) statusClass = 'blacklisted';
        else if (isTimedOut) statusClass = 'timed-out';

        let timeoutInfo = '';
        if (isTimedOut) {
          const timeLeft = Math.ceil((new Date(user.timeoutUntil) - now) / 60000);
          timeoutInfo = `<p><i class="fas fa-clock"></i> Timeout expires in ${timeLeft} minutes</p>`;
        }

        const userDiv = document.createElement('div');
        userDiv.className = `user-item ${statusClass}`;
        userDiv.innerHTML = `
          <div class="user-info">
            <div class="user-details">
              <h4><i class="fas fa-user"></i> ${sanitizeInput(user.name || 'User')}</h4>
              <p><i class="fas fa-envelope"></i> ${sanitizeInput(user.email)}</p>
              <p><i class="fas fa-calendar"></i> Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
              ${timeoutInfo}
              <div class="user-badges">
                ${isDev ? '<span class="badge badge-dev"><i class="fas fa-code"></i> DEVELOPER</span>' : ''}
                ${isHeadStaff ? '<span class="badge badge-head-staff"><i class="fas fa-crown"></i> HEAD STAFF</span>' : ''}
                ${isStaff ? '<span class="badge badge-staff"><i class="fas fa-shield-alt"></i> STAFF</span>' : ''}
                ${isBlacklisted ? '<span class="badge badge-blacklisted"><i class="fas fa-ban"></i> BLACKLISTED</span>' : ''}
                ${isTimedOut ? '<span class="badge badge-timeout"><i class="fas fa-clock"></i> TIMED OUT</span>' : ''}
              </div>
            </div>
            <div class="user-actions">
              ${!isSelf && !isTimedOut && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-timeout" onclick="timeoutUser(${user.id})"><i class="fas fa-clock"></i> Timeout</button>` : ''}
              ${!isSelf && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-request" onclick="openBanRequestModalById(${user.id}, 'staff-message')"><i class="fas fa-flag"></i> Ban Request</button>` : ''}
              ${!isSelf && isTimedOut && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-restore" onclick="restoreUser(${user.id})"><i class="fas fa-undo"></i> Restore Timeout</button>` : ''}
              ${isSelf ? '<span style="color: #888; font-size: 0.85rem;"><i class="fas fa-info-circle"></i> You (cannot modify)</span>' : ''}
            </div>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function timeoutUser(userId) {
      const duration = getTimeoutDuration('staff-timeout-duration');
      if (!duration) {
        showPanelMessage('staff-message', 'Select a valid timeout duration.', 'error');
        return;
      }

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      if (userIndex === -1) {
        showPanelMessage('staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Timeout User',
        message: `Timeout ${target.email} for ${duration.label}?`,
        confirmText: 'Timeout',
        confirmClass: 'warning',
        onConfirm: () => {
          const timeoutUntil = new Date();
          timeoutUntil.setMinutes(timeoutUntil.getMinutes() + duration.minutes);
          
          users[userIndex].timeoutUntil = timeoutUntil.toISOString();
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('staff-message', `User timed out for ${duration.label}.`, 'success');
          loadStaffPanel();
        }
      });
    }

    function blacklistUser(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Blacklist User',
        message: `Blacklist ${target.email}? This will block all access.`,
        confirmText: 'Blacklist',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].blacklisted = true;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showUniversalBanMessage();

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('staff-message', 'User permanently blacklisted.', 'success');
          loadStaffPanel();
        }
      });
    }

    function restoreUser(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Restore Access',
        message: `Restore access for ${target.email}?`,
        confirmText: 'Restore',
        onConfirm: () => {
          users[userIndex].blacklisted = false;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showPanelMessage('staff-message', 'User access restored.', 'success');
          loadStaffPanel();
        }
      });
    }

    function toggleStaff(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('staff-message', 'User not found.', 'error');
        return;
      }

      const isCurrentlyStaff = users[userIndex].isStaff || false;

      const target = users[userIndex];
      openActionModal({
        title: isCurrentlyStaff ? 'Revoke Staff' : 'Grant Staff',
        message: isCurrentlyStaff
          ? `Revoke staff privileges from ${target.email}?`
          : `Grant staff privileges to ${target.email}?`,
        confirmText: isCurrentlyStaff ? 'Revoke' : 'Grant',
        confirmClass: isCurrentlyStaff ? 'danger' : '',
        onConfirm: () => {
          users[userIndex].isStaff = !isCurrentlyStaff;
          localStorage.setItem('users', JSON.stringify(users));

          showPanelMessage(
            'staff-message',
            isCurrentlyStaff ? 'Staff privileges revoked.' : 'Staff privileges granted.',
            'success'
          );
          loadStaffPanel();
        }
      });
    }

    // Open signup modal
    function openSignupModal() {
      closeModal('loginModal');
      document.getElementById('signupModal').classList.add('active');
      document.getElementById('signupEmail').focus();
    }

    // Open login modal
    function openLoginModal() {
      window.open('login.html', '_blank');
    }

    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    // Switch from login to signup
    function switchToSignup() {
      window.open('signup.html', '_blank');
    }

    // Switch from signup to login
    function switchToLogin() {
      window.open('login.html', '_blank');
    }
    
    // Open signup modal
    function openSignupModal() {
      window.open('signup.html', '_blank');
    }

    // Handle signup
    async function handleSignup() {
      const name = sanitizeInput(document.getElementById('signupName').value.trim());
      const email = sanitizeInput(document.getElementById('signupEmail').value.trim().toLowerCase());
      const password = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('signupConfirm').value;
      const errorDiv = document.getElementById('signupError');

      errorDiv.classList.remove('show');
      errorDiv.textContent = '';

      // Name is optional (removed validation)

      if (!email) {
        showError(errorDiv, 'Please enter your email');
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showError(errorDiv, 'Please enter a valid email address');
        return;
      }

      if (password.length < 8) {
        showError(errorDiv, 'Password must be at least 8 characters');
        return;
      }

      // Validate password strength
      const hasUpperCase = /[A-Z]/.test(password);
      const hasLowerCase = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);

      if (!hasUpperCase) {
        showError(errorDiv, 'Password must contain at least one uppercase letter');
        return;
      }

      if (!hasLowerCase) {
        showError(errorDiv, 'Password must contain at least one lowercase letter');
        return;
      }

      if (!hasNumber) {
        showError(errorDiv, 'Password must contain at least one number');
        return;
      }

      // Special characters are recommended but not required
      // if (!hasSpecialChar) {
      //   showError(errorDiv, 'Password must contain at least one special character (!@#$%^&*)');
      //   return;
      // }

      if (password !== confirm) {
        showError(errorDiv, 'Passwords do not match');
        return;
      }

      // Check if email already exists
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      if (users.some(u => u.email === email)) {
        showError(errorDiv, 'Email is already registered');
        return;
      }

      // Hash password before storing
      const hashedPassword = await hashPassword(password);

      // Create new user
      const newUser = {
        id: Date.now(),
        name: name || 'User',
        email: email,
        password: hashedPassword,
        createdAt: new Date().toISOString()
      };

      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('currentUser', JSON.stringify({ id: newUser.id, name: newUser.name, email: newUser.email }));

      // Reset form and close modal
      document.getElementById('signupName').value = '';
      document.getElementById('signupEmail').value = '';
      document.getElementById('signupPassword').value = '';
      document.getElementById('signupConfirm').value = '';
      closeModal('signupModal');

      updateNavBar({ name: newUser.name });
      showToast('Account created successfully! Welcome!', 'success');
      
      // Landing page disabled - no need to hide
    }

    // Handle login
    async function handleLogin() {
      const email = sanitizeInput(document.getElementById('loginEmail').value.trim().toLowerCase());
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');

      errorDiv.classList.remove('show');
      errorDiv.textContent = '';

      if (!email) {
        showError(errorDiv, 'Please enter your email');
        return;
      }

      if (!password) {
        showError(errorDiv, 'Please enter your password');
        return;
      }

      // Check rate limit
      if (!checkRateLimit(email)) {
        showError(errorDiv, 'Too many login attempts. Please try again in 15 minutes.');
        return;
      }

      // Hash password to compare
      const hashedPassword = await hashPassword(password);

      // Find user
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.email === email && u.password === hashedPassword);

      if (!user) {
        showError(errorDiv, 'Email or password is incorrect');
        return;
      }

      // Check if user is restricted before allowing login
      if (user.blacklisted) {
        showError(errorDiv, 'This account has been blacklisted. Access denied.');
        return;
      }

      if (user.timeoutUntil && new Date(user.timeoutUntil) > new Date()) {
        const timeLeft = Math.ceil((new Date(user.timeoutUntil) - new Date()) / 60000);
        showError(errorDiv, `This account is timed out. Access will be restored in ${timeLeft} minutes.`);
        return;
      }

      // Login successful
      localStorage.setItem('currentUser', JSON.stringify({ id: user.id, name: user.name, email: user.email }));
      document.getElementById('loginEmail').value = '';
      document.getElementById('loginPassword').value = '';
      closeModal('loginModal');

      // Reset rate limit on successful login
      delete loginAttempts[email];

      updateNavBar({ name: user.name });
      showToast('Logged in successfully! Welcome back, ' + user.name + '!', 'success');
      
      // Landing page disabled - no need to hide
    }

    // Logout
    function logout() {
      exitTestMode(true);
      localStorage.removeItem('currentUser');
      
      // Show login/signup buttons
      const navAuth = document.getElementById('nav-auth');
      if (navAuth) {
        navAuth.style.display = 'flex';
      }
      
      // Hide user menu
      document.getElementById('user-menu').style.display = 'none';
      
      // Close sidebar if open
      const sidebar = document.querySelector('.sidebar-menu');
      const overlay = document.querySelector('.sidebar-overlay');
      const hamburger = document.querySelector('.hamburger-menu');
      if (sidebar) sidebar.classList.remove('active');
      if (overlay) overlay.classList.remove('active');
      if (hamburger) hamburger.classList.remove('hidden');
      
      showToast('You have been logged out', 'success');
      
      // Reload to reset UI
      setTimeout(() => window.location.reload(), 500);
    }

    // ===== SIDEBAR MENU FUNCTIONS =====
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar-menu');
      const overlay = document.querySelector('.sidebar-overlay');
      const hamburger = document.querySelector('.hamburger-menu');
      
      if (sidebar && overlay) {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
        
        // Hide hamburger when sidebar is open
        if (hamburger) {
          hamburger.classList.toggle('hidden');
        }
      }
    }

    // ===== ORDER HISTORY =====
    function openOrderHistory() {
      const modal = document.getElementById('orderHistoryModal');
      const content = document.getElementById('orderHistoryContent');
      
      // Load orders from localStorage
      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      
      if (orders.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #888; padding: 2rem;">No orders yet. Make your first purchase!</p>';
      } else {
        let tableHTML = '<table class="order-table"><thead><tr><th>Date</th><th>Product</th><th>Amount</th><th>Status</th></tr></thead><tbody>';
        
        orders.forEach(order => {
          const date = new Date(order.date).toLocaleDateString();
          tableHTML += `
            <tr>
              <td>${date}</td>
              <td>${order.product}</td>
              <td>$${order.amount}</td>
              <td><span class="ticket-status ${order.status}">${order.status}</span></td>
            </tr>
          `;
        });
        
        tableHTML += '</tbody></table>';
        content.innerHTML = tableHTML;
      }
      
      modal.style.display = 'flex';
      toggleSidebar(); // Close sidebar
    }

    function closeOrderHistory() {
      document.getElementById('orderHistoryModal').style.display = 'none';
    }

    // ===== SUPPORT/TICKETS =====
    function openSupport() {
      const modal = document.getElementById('supportModal');
      loadTickets();
      updateTicketBadge();
      modal.style.display = 'flex';
      toggleSidebar(); // Close sidebar
    }

    function closeSupport() {
      document.getElementById('supportModal').style.display = 'none';
    }

    function switchSupportTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.modal-tab').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      if (tab === 'tickets') {
        document.getElementById('ticketsTab').classList.add('active');
        document.getElementById('newTicketTab').classList.remove('active');
        loadTickets();
      } else {
        document.getElementById('ticketsTab').classList.remove('active');
        document.getElementById('newTicketTab').classList.add('active');
      }
    }

    function loadTickets() {
      const ticketsList = document.getElementById('ticketsList');
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      if (!currentUser) {
        ticketsList.innerHTML = '<p style="text-align: center; color: #888; padding: 2rem;">Please log in to view tickets.</p>';
        return;
      }
      
      const allTickets = JSON.parse(localStorage.getItem('tickets') || '[]');
      const userTickets = allTickets.filter(t => t.userId === currentUser.email);
      
      if (userTickets.length === 0) {
        ticketsList.innerHTML = '<p style="text-align: center; color: #888; padding: 2rem;">No tickets yet.</p>';
        return;
      }
      
      let ticketsHTML = '';
      userTickets.forEach(ticket => {
        const date = new Date(ticket.date).toLocaleString();
        ticketsHTML += `
          <div class="ticket-card">
            <div class="ticket-header">
              <div>
                <span class="ticket-status ${ticket.status}">${ticket.status.replace('-', ' ')}</span>
                <span class="ticket-priority ${ticket.priority}" style="margin-left: 0.5rem;">${ticket.priority}</span>
              </div>
              <small style="color: #888;">#${ticket.id}</small>
            </div>
            <h4 style="margin: 0 0 0.5rem 0;">${ticket.subject}</h4>
            <p style="color: #aaa; margin-bottom: 0.5rem;">${ticket.message}</p>
            <small style="color: #666;">${date}</small>
          </div>
        `;
      });
      
      ticketsList.innerHTML = ticketsHTML;
    }

    function createTicket(event) {
      event.preventDefault();
      
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) {
        showToast('Please log in to create a ticket', 'error');
        return;
      }
      
      const subject = document.getElementById('ticketSubject').value;
      const priority = document.getElementById('ticketPriority').value;
      const message = document.getElementById('ticketMessage').value;
      
      const ticket = {
        id: Date.now(),
        userId: currentUser.email,
        subject: subject,
        priority: priority,
        message: message,
        status: 'open',
        date: Date.now()
      };
      
      const tickets = JSON.parse(localStorage.getItem('tickets') || '[]');
      tickets.push(ticket);
      localStorage.setItem('tickets', JSON.stringify(tickets));
      
      showToast('Ticket created successfully!', 'success');
      document.getElementById('newTicketForm').reset();
      switchSupportTab('tickets');
      loadTickets();
      updateTicketBadge();
    }

    function updateTicketBadge() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) return;
      
      const allTickets = JSON.parse(localStorage.getItem('tickets') || '[]');
      const openTickets = allTickets.filter(t => t.userId === currentUser.email && t.status === 'open').length;
      
      const badge = document.getElementById('ticketBadge');
      if (badge) {
        if (openTickets > 0) {
          badge.textContent = openTickets;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }
    }

    // ===== SETTINGS =====
    function openSettings() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      if (!currentUser) {
        showToast('Please log in to access settings', 'error');
        return;
      }
      
      // Open settings in new tab
      window.open('settings.html', '_blank');
      toggleSidebar(); // Close sidebar
    }

    // Update navigation bar based on auth state
    function updateNavBar(user) {
      if (!user || (!user.id && !user.email)) {
        user = JSON.parse(localStorage.getItem('currentUser') || 'null') || user;
      }
      // Hide login/signup buttons when logged in
      const navAuth = document.getElementById('nav-auth');
      if (navAuth) {
        navAuth.style.display = 'none';
      }
      
      // Show user menu
      document.getElementById('user-menu').style.display = 'flex';
      document.getElementById('user-display').textContent = ' ' + user.name;
      
      // Show buttons based on user permissions
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      let fullUser = users.find(u => u.id === user.id) || users.find(u => u.email === user.email);

      if (!fullUser && user && user.email) {
        fullUser = {
          id: user.id || Date.now(),
          name: user.name || 'User',
          email: user.email,
          createdAt: new Date().toISOString()
        };
        users.push(fullUser);
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.setItem('currentUser', JSON.stringify({ id: fullUser.id, name: fullUser.name, email: fullUser.email }));
      }
      
      if (fullUser) {
        // Show dev button if user is developer
        if (fullUser.isDev) {
          const devBtn = document.getElementById('dev-btn');
          const devNotif = document.getElementById('dev-notif-wrapper');
          if (devBtn) devBtn.style.display = 'block';
          if (devNotif) devNotif.style.display = 'flex';
          document.getElementById('menu-dev-panel').style.display = 'flex';
          renderDevNotifications();
        } else {
          const devBtn = document.getElementById('dev-btn');
          const devNotif = document.getElementById('dev-notif-wrapper');
          if (devBtn) devBtn.style.display = 'none';
          if (devNotif) devNotif.style.display = 'none';
          document.getElementById('menu-dev-panel').style.display = 'none';
        }
        
        // Show head staff button if user is head staff
        if (fullUser.isHeadStaff) {
          const headBtn = document.getElementById('head-staff-btn');
          if (headBtn) headBtn.style.display = 'block';
          document.getElementById('menu-head-panel').style.display = 'flex';
        } else {
          const headBtn = document.getElementById('head-staff-btn');
          if (headBtn) headBtn.style.display = 'none';
          document.getElementById('menu-head-panel').style.display = 'none';
        }
        
        // Show staff button if user is staff
        if (fullUser.isStaff) {
          const staffBtn = document.getElementById('staff-btn');
          if (staffBtn) staffBtn.style.display = 'block';
          document.getElementById('menu-staff-panel').style.display = 'flex';
        } else {
          const staffBtn = document.getElementById('staff-btn');
          if (staffBtn) staffBtn.style.display = 'none';
          document.getElementById('menu-staff-panel').style.display = 'none';
        }
      }
    }

    // ====== HEAD STAFF PANEL FUNCTIONS ======

    function openHeadStaffPanel() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id);

      if (!user || !user.isHeadStaff) {
        showToast('Access denied. Head Staff privileges required.', 'error');
        return;
      }

      document.getElementById('headStaffPanel').classList.add('active');
      loadHeadStaffPanel();
    }

    function closeHeadStaffPanel() {
      document.getElementById('headStaffPanel').classList.remove('active');
    }

    function loadHeadStaffPanel() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const now = new Date();

      // Calculate stats
      const totalUsers = users.length;
      const activeUsers = users.filter(u => !u.blacklisted && (!u.timeoutUntil || new Date(u.timeoutUntil) <= now)).length;
      const blacklisted = users.filter(u => u.blacklisted).length;
      const timedOut = users.filter(u => u.timeoutUntil && new Date(u.timeoutUntil) > now).length;

      document.getElementById('head-stat-total-users').textContent = totalUsers;
      document.getElementById('head-stat-active-users').textContent = activeUsers;
      document.getElementById('head-stat-blacklisted').textContent = blacklisted;
      document.getElementById('head-stat-timed-out').textContent = timedOut;

      // Load users list
      const container = document.getElementById('head-users-container');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem;">No users registered yet.</p>';
        return;
      }

      users.forEach(user => {
        const isBlacklisted = user.blacklisted || false;
        const isTimedOut = user.timeoutUntil && new Date(user.timeoutUntil) > now;
        const isStaff = user.isStaff || false;
        const isHeadStaff = user.isHeadStaff || false;
        const isDev = user.isDev || false;
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const isSelf = user.id === currentUser.id;

        let statusClass = '';
        if (isBlacklisted) statusClass = 'blacklisted';
        else if (isTimedOut) statusClass = 'timed-out';

        let timeoutInfo = '';
        if (isTimedOut) {
          const timeLeft = Math.ceil((new Date(user.timeoutUntil) - now) / 60000);
          timeoutInfo = `<p><i class="fas fa-clock"></i> Timeout expires in ${timeLeft} minutes</p>`;
        }

        const userDiv = document.createElement('div');
        userDiv.className = `user-item ${statusClass}`;
        userDiv.innerHTML = `
          <div class="user-info">
            <div class="user-details">
              <h4><i class="fas fa-user"></i> ${sanitizeInput(user.name || 'User')}</h4>
              <p><i class="fas fa-envelope"></i> ${sanitizeInput(user.email)}</p>
              <p><i class="fas fa-calendar"></i> Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
              ${timeoutInfo}
              <div class="user-badges">
                ${isDev ? '<span class="badge badge-dev"><i class="fas fa-code"></i> DEVELOPER</span>' : ''}
                ${isHeadStaff ? '<span class="badge badge-head-staff"><i class="fas fa-crown"></i> HEAD STAFF</span>' : ''}
                ${isStaff ? '<span class="badge badge-staff"><i class="fas fa-shield-alt"></i> STAFF</span>' : ''}
                ${isBlacklisted ? '<span class="badge badge-blacklisted"><i class="fas fa-ban"></i> BLACKLISTED</span>' : ''}
                ${isTimedOut ? '<span class="badge badge-timeout"><i class="fas fa-clock"></i> TIMED OUT</span>' : ''}
              </div>
            </div>
            <div class="user-actions">
              ${!isSelf && !isStaff && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-staff" onclick="makeStaffFromHead(${user.id})">Make Staff</button>` : ''}
              ${!isSelf && !isTimedOut && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-timeout" onclick="timeoutUserFromHead(${user.id})"><i class="fas fa-clock"></i> Timeout</button>` : ''}
              ${!isSelf && !isBlacklisted && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-blacklist" onclick="blacklistUserFromHead(${user.id})"><i class="fas fa-ban"></i> Blacklist</button>` : ''}
              ${!isSelf && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-request" onclick="openBanRequestModalById(${user.id}, 'head-staff-message')"><i class="fas fa-flag"></i> Ban Request</button>` : ''}
              ${!isSelf && (isBlacklisted || isTimedOut) && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-restore" onclick="restoreUserFromHead(${user.id})"><i class="fas fa-undo"></i> Restore Access</button>` : ''}
              ${isSelf ? '<span style="color: #888; font-size: 0.85rem;"><i class="fas fa-info-circle"></i> You (cannot modify)</span>' : ''}
            </div>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function apiBanFromHead() {
      const emailInput = document.getElementById('head-api-email');
      const email = emailInput ? emailInput.value.trim().toLowerCase() : '';
      if (!email) {
        showPanelMessage('head-staff-message', 'Please enter an email address.', 'error');
        return;
      }

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.email === email);

      if (!user) {
        showPanelMessage('head-staff-message', 'User not found.', 'error');
        return;
      }

      if (user.isDev) {
        showPanelMessage('head-staff-message', 'Cannot API ban developer accounts.', 'error');
        return;
      }

      const apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
      if (apiBans.includes(email)) {
        showPanelMessage('head-staff-message', 'This user is already API banned.', 'error');
        return;
      }

      openActionModal({
        title: 'Ban API Access',
        message: `Ban API access for ${email}?`,
        confirmText: 'Ban',
        confirmClass: 'danger',
        onConfirm: () => {
          apiBans.push(email);
          localStorage.setItem('apiBans', JSON.stringify(apiBans));

          showUniversalBanMessage();
          if (emailInput) emailInput.value = '';
          showPanelMessage('head-staff-message', 'User API banned.', 'success');
          renderApiBansForHead();
        }
      });
    }

    function viewAPIBansFromHead() {
      const container = document.getElementById('head-api-bans');
      if (!container) return;

      const isHidden = container.style.display === 'none' || container.style.display === '';
      container.style.display = isHidden ? 'block' : 'none';
      if (isHidden) {
        renderApiBansForHead();
      }
    }

    function renderApiBansForHead() {
      const container = document.getElementById('head-api-bans');
      if (!container) return;

      const apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
      container.innerHTML = '';

      if (apiBans.length === 0) {
        container.innerHTML = '<p style="color: #888;">No API bans.</p>';
        return;
      }

      apiBans.forEach(email => {
        const row = document.createElement('div');
        row.className = 'ban-item';
        row.innerHTML = `
          <span>${sanitizeInput(email)}</span>
          <button type="button" onclick="unbanApi('${email}')">Unban</button>
        `;
        container.appendChild(row);
      });
    }

    function makeStaffFromHead(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('head-staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Promote to Staff',
        message: `Promote ${target.email} to Staff?`,
        confirmText: 'Promote',
        onConfirm: () => {
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          showPanelMessage('head-staff-message', 'User promoted to Staff.', 'success');
          loadHeadStaffPanel();
        }
      });
    }

    function timeoutUserFromHead(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('head-staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      const duration = { minutes: 30, label: '30 minutes' };

      openActionModal({
        title: 'Timeout User',
        message: `Timeout ${target.email} for ${duration.label}?`,
        confirmText: 'Timeout',
        confirmClass: 'warning',
        onConfirm: () => {
          const timeoutUntil = new Date();
          timeoutUntil.setMinutes(timeoutUntil.getMinutes() + duration.minutes);
          
          users[userIndex].timeoutUntil = timeoutUntil.toISOString();
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('head-staff-message', `User timed out for ${duration.label}.`, 'success');
          loadHeadStaffPanel();
        }
      });
    }

    function blacklistUserFromHead(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('head-staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Blacklist User',
        message: `Blacklist ${target.email}? This will block all access.`,
        confirmText: 'Blacklist',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].blacklisted = true;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showUniversalBanMessage();

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('head-staff-message', 'User permanently blacklisted.', 'success');
          loadHeadStaffPanel();
        }
      });
    }

    function restoreUserFromHead(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('head-staff-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Restore Access',
        message: `Restore access for ${target.email}?`,
        confirmText: 'Restore',
        onConfirm: () => {
          users[userIndex].blacklisted = false;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showPanelMessage('head-staff-message', 'User access restored.', 'success');
          loadHeadStaffPanel();
        }
      });
    }


    // ====== DEV PANEL FUNCTIONS ======

    function checkMaintenanceMode() {
      const maintenanceMode = localStorage.getItem('maintenanceMode') === 'true';
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      
      if (maintenanceMode) {
        // Check if user is developer
        if (currentUser) {
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const user = users.find(u => u.id === currentUser.id);
          if (user && user.isDev) {
            // Developer can bypass maintenance mode
            document.getElementById('maintenanceOverlay').classList.remove('active');
            return;
          }
        }
        
        // Show maintenance mode for everyone else
        document.getElementById('maintenanceOverlay').classList.add('active');
      } else {
        document.getElementById('maintenanceOverlay').classList.remove('active');
      }
    }

    function openDevPanel() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id);

      if (!user || !user.isDev) {
        showToast('Access denied. Developer privileges required.', 'error');
        return;
      }

      document.getElementById('devPanel').classList.add('active');
      loadDevPanel();
      markAllDevNotificationsRead();
    }

    function closeDevPanel() {
      document.getElementById('devPanel').classList.remove('active');
    }

    function loadDevPanel() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const ipBans = JSON.parse(localStorage.getItem('ipBans') || '[]');
      const apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
      const priceLimits = JSON.parse(localStorage.getItem('priceLimits') || '{"min":1,"max":10000}');

      // Update analytics
      const totalUsers = users.length;
      const staffCount = users.filter(u => u.isStaff || u.isDev).length;
      const bannedCount = users.filter(u => u.blacklisted).length;
      const now = new Date();
      const activeUsers = users.filter(u => !u.blacklisted && (!u.timeoutUntil || new Date(u.timeoutUntil) <= now)).length;

      // Update overview
      document.getElementById('overview-total-users').textContent = totalUsers;
      document.getElementById('overview-active-users').textContent = activeUsers;
      document.getElementById('overview-staff-count').textContent = staffCount;
      document.getElementById('overview-banned-count').textContent = bannedCount;

      // Update user overview list
      const overviewContainer = document.getElementById('dev-user-overview');
      overviewContainer.innerHTML = '';
      users.forEach(user => {
        const item = document.createElement('div');
        item.style.padding = '0.75rem';
        item.style.borderBottom = '1px solid var(--border)';
        item.style.fontSize = '0.9rem';
        item.innerHTML = `
          <strong>${sanitizeInput(user.name)}</strong> - ${sanitizeInput(user.email)}
          ${user.isDev ? '<span style="color: #ff0080; margin-left: 0.5rem;"><i class="fas fa-code"></i> Dev</span>' : ''}
          ${user.isHeadStaff ? '<span style="color: #dc2626; margin-left: 0.5rem;"><i class="fas fa-crown"></i> Head Staff</span>' : ''}
          ${user.isStaff ? '<span style="color: #a855f7; margin-left: 0.5rem;"><i class="fas fa-shield-alt"></i> Staff</span>' : ''}
          ${user.blacklisted ? '<span style="color: #ff6b6b; margin-left: 0.5rem;"><i class="fas fa-ban"></i> Banned</span>' : ''}
        `;
        overviewContainer.appendChild(item);
      });

      // Update ban counts
      document.getElementById('ipBanCount').textContent = ipBans.length;
      document.getElementById('apiBanCount').textContent = apiBans.length;

      // Update price inputs
      const devMinPrice = document.getElementById('dev-min-price');
      if (devMinPrice) devMinPrice.value = priceLimits.min;
      const devMaxPrice = document.getElementById('dev-max-price');
      if (devMaxPrice) devMaxPrice.value = priceLimits.max;

      // Update maintenance button
      const maintenanceMode = localStorage.getItem('maintenanceMode') === 'true';
      const maintenanceText = document.getElementById('maintenanceText');
      if (maintenanceText) {
        maintenanceText.textContent = maintenanceMode ? 'Disable Maintenance' : 'Enable Maintenance';
      }

      renderIpBans();
      renderApiBans();

      // Load moderation list
      loadDevUserModerationList();

      // Load permissions list
      loadDevPermissionsList();

      // Load ban requests
      renderBanRequests();
    }

    function loadDevUserModerationList() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const now = new Date();
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const container = document.getElementById('dev-users-container');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem;">No users registered yet.</p>';
        return;
      }

      users.forEach(user => {
        const isBlacklisted = user.blacklisted || false;
        const isTimedOut = user.timeoutUntil && new Date(user.timeoutUntil) > now;
        const isHeadStaff = user.isHeadStaff || false;
        const isDev = user.isDev || false;
        const isSelf = currentUser && user.id === currentUser.id;

        let statusClass = '';
        if (isBlacklisted) statusClass = 'blacklisted';
        else if (isTimedOut) statusClass = 'timed-out';

        let timeoutInfo = '';
        if (isTimedOut) {
          const timeLeft = Math.ceil((new Date(user.timeoutUntil) - now) / 60000);
          timeoutInfo = `<p><i class="fas fa-clock"></i> Timeout expires in ${timeLeft} minutes</p>`;
        }

        const userDiv = document.createElement('div');
        userDiv.className = `user-item ${statusClass}`;
        userDiv.innerHTML = `
          <div class="user-info">
            <div class="user-details">
              <h4><i class="fas fa-user"></i> ${sanitizeInput(user.name || 'User')}</h4>
              <p><i class="fas fa-envelope"></i> ${sanitizeInput(user.email)}</p>
              <p><i class="fas fa-calendar"></i> Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
              ${timeoutInfo}
              <div class="user-badges">
                ${isDev ? '<span class="badge badge-dev"><i class="fas fa-code"></i> DEVELOPER</span>' : ''}
                ${isHeadStaff ? '<span class="badge badge-head-staff"><i class="fas fa-crown"></i> HEAD STAFF</span>' : ''}
                ${user.isStaff ? '<span class="badge badge-staff"><i class="fas fa-shield-alt"></i> STAFF</span>' : ''}
                ${isBlacklisted ? '<span class="badge badge-blacklisted"><i class="fas fa-ban"></i> BLACKLISTED</span>' : ''}
                ${isTimedOut ? '<span class="badge badge-timeout"><i class="fas fa-clock"></i> TIMED OUT</span>' : ''}
              </div>
            </div>
            <div class="user-actions">
              ${!isSelf && !isDev && !isTimedOut ? `<button class="action-btn action-btn-timeout" onclick="timeoutUserFromDev(${user.id})"><i class="fas fa-clock"></i> Timeout</button>` : ''}
              ${!isSelf && !isDev && !isBlacklisted ? `<button class="action-btn action-btn-blacklist" onclick="blacklistUserFromDev(${user.id})"><i class="fas fa-ban"></i> Blacklist</button>` : ''}
              ${!isSelf && (isBlacklisted || isTimedOut) ? `<button class="action-btn action-btn-restore" onclick="restoreUserFromDev(${user.id})"><i class="fas fa-undo"></i> Restore Access</button>` : ''}
              ${isSelf ? '<span style="color: #888; font-size: 0.85rem;"><i class="fas fa-info-circle"></i> You (cannot modify)</span>' : ''}
            </div>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function renderIpBans() {
      const container = document.getElementById('dev-ip-bans');
      if (!container) return;

      const ipBans = JSON.parse(localStorage.getItem('ipBans') || '[]');
      container.innerHTML = '';

      if (ipBans.length === 0) {
        container.innerHTML = '<p style="color: #888;">No IP bans.</p>';
        return;
      }

      ipBans.forEach(ip => {
        const row = document.createElement('div');
        row.className = 'ban-item';
        row.innerHTML = `
          <span>${sanitizeInput(ip)}</span>
          <button type="button" onclick="unbanIp('${ip}')">Unban</button>
        `;
        container.appendChild(row);
      });
    }

    function renderApiBans() {
      const container = document.getElementById('dev-api-bans');
      if (!container) return;

      const apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
      container.innerHTML = '';

      if (apiBans.length === 0) {
        container.innerHTML = '<p style="color: #888;">No API bans.</p>';
        return;
      }

      apiBans.forEach(email => {
        const row = document.createElement('div');
        row.className = 'ban-item';
        row.innerHTML = `
          <span>${sanitizeInput(email)}</span>
          <button type="button" onclick="unbanApi('${email}')">Unban</button>
        `;
        container.appendChild(row);
      });
    }

    function renderBanRequests() {
      const container = document.getElementById('dev-ban-requests');
      if (!container) return;

      const requests = JSON.parse(localStorage.getItem('banRequests') || '[]');
      container.innerHTML = '';

      if (requests.length === 0) {
        container.innerHTML = '<p style="color: #888;">No ban requests.</p>';
        return;
      }

      requests.forEach(request => {
        const isFocused = focusedBanRequestId && request.id === focusedBanRequestId;
        const status = request.status || 'pending';
        const statusLabel = status === 'approved'
          ? 'Approved'
          : status === 'denied'
            ? 'Denied'
            : 'Pending';

        const item = document.createElement('div');
        item.className = `request-item${isFocused ? ' highlight' : ''}`;
        item.dataset.requestId = request.id;
        item.innerHTML = `
          <strong>${sanitizeInput(request.targetEmail)}</strong>
          <div class="request-meta">Requested by ${sanitizeInput(request.requestedByName || 'User')}  ${new Date(request.createdAt).toLocaleString()}  ${statusLabel}</div>
          <div>${sanitizeInput(request.reason)}</div>
          <div class="request-actions">
            ${status === 'pending' ? `
              <button type="button" class="approve-btn" onclick="approveBanRequest(${request.id})">Approve</button>
              <button type="button" class="deny-btn" onclick="denyBanRequest(${request.id})">Deny</button>
            ` : ''}
          </div>
        `;
        container.appendChild(item);
      });

      if (focusedBanRequestId) {
        const focusedItem = container.querySelector(`[data-request-id="${focusedBanRequestId}"]`);
        if (focusedItem) {
          focusedItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
          setTimeout(() => {
            focusedItem.classList.remove('highlight');
          }, 2500);
        } else {
          showPanelMessage('dev-message', 'Ban request not found for that notification.', 'info');
        }
        focusedBanRequestId = null;
      }
    }

    function approveBanRequest(requestId) {
      const requests = JSON.parse(localStorage.getItem('banRequests') || '[]');
      const requestIndex = requests.findIndex(r => r.id === requestId);
      if (requestIndex === -1) {
        showPanelMessage('dev-message', 'Ban request not found.', 'error');
        return;
      }

      const request = requests[requestIndex];
      openActionModal({
        title: 'Approve Ban Request',
        message: `Blacklist ${request.targetEmail}?`,
        confirmText: 'Approve',
        confirmClass: 'danger',
        onConfirm: () => {
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const userIndex = users.findIndex(u => u.id === request.targetUserId || u.email === request.targetEmail);
          if (userIndex === -1) {
            showPanelMessage('dev-message', 'Target user not found.', 'error');
            return;
          }

          users[userIndex].blacklisted = true;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showUniversalBanMessage();

          requests[requestIndex].status = 'approved';
          requests[requestIndex].resolvedAt = new Date().toISOString();
          localStorage.setItem('banRequests', JSON.stringify(requests));

          showPanelMessage('dev-message', 'Ban request approved and user blacklisted.', 'success');
          loadDevPanel();
        }
      });
    }

    function denyBanRequest(requestId) {
      const requests = JSON.parse(localStorage.getItem('banRequests') || '[]');
      const requestIndex = requests.findIndex(r => r.id === requestId);
      if (requestIndex === -1) {
        showPanelMessage('dev-message', 'Ban request not found.', 'error');
        return;
      }

      openActionModal({
        title: 'Deny Ban Request',
        message: `Deny ban request for ${requests[requestIndex].targetEmail}?`,
        confirmText: 'Deny',
        confirmClass: 'warning',
        onConfirm: () => {
          requests[requestIndex].status = 'denied';
          requests[requestIndex].resolvedAt = new Date().toISOString();
          localStorage.setItem('banRequests', JSON.stringify(requests));

          showPanelMessage('dev-message', 'Ban request denied.', 'success');
          renderBanRequests();
        }
      });
    }

    function unbanIp(ip) {
      openActionModal({
        title: 'Unban IP',
        message: `Unban IP ${ip}?`,
        confirmText: 'Unban',
        onConfirm: () => {
          const ipBans = JSON.parse(localStorage.getItem('ipBans') || '[]');
          const index = ipBans.indexOf(ip);
          if (index === -1) {
            showPanelMessage('dev-message', 'IP not found in ban list.', 'error');
            return;
          }

          ipBans.splice(index, 1);
          localStorage.setItem('ipBans', JSON.stringify(ipBans));
          showPanelMessage('dev-message', 'IP unbanned.', 'success');
          loadDevPanel();
        }
      });
    }

    function unbanApi(email) {
      openActionModal({
        title: 'Unban API User',
        message: `Unban API access for ${email}?`,
        confirmText: 'Unban',
        onConfirm: () => {
          const apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
          const index = apiBans.indexOf(email);
          if (index === -1) {
            showPanelMessage('dev-message', 'Email not found in API ban list.', 'error');
            return;
          }

          apiBans.splice(index, 1);
          localStorage.setItem('apiBans', JSON.stringify(apiBans));
          showPanelMessage('dev-message', 'API user unbanned.', 'success');
          loadDevPanel();
        }
      });
    }

    function loadDevPermissionsList() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const container = document.getElementById('dev-permissions-list');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem;">No users registered yet.</p>';
        return;
      }

      users.forEach(user => {
        const isStaff = user.isStaff || false;
        const isHeadStaff = user.isHeadStaff || false;
        const isDev = user.isDev || false;
        const isSelf = user.id === currentUser.id;

        const userDiv = document.createElement('div');
        userDiv.className = 'permission-item';
        userDiv.style.marginBottom = '1rem';
        userDiv.innerHTML = `
          <div class="permission-info">
            <div class="permission-details">
              <h4><i class="fas fa-user"></i> ${sanitizeInput(user.name || 'User')}</h4>
              <p><i class="fas fa-envelope"></i> ${sanitizeInput(user.email)}</p>
              <p><i class="fas fa-calendar"></i> Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
              <div class="user-badges" style="margin-top: 0.5rem;">
                ${isDev ? '<span class="badge badge-dev"><i class="fas fa-code"></i> DEVELOPER</span>' : ''}
                ${isHeadStaff ? '<span class="badge badge-head-staff"><i class="fas fa-crown"></i> HEAD STAFF</span>' : ''}
                ${isStaff ? '<span class="badge badge-staff"><i class="fas fa-shield-alt"></i> STAFF</span>' : ''}
              </div>
            </div>
            <div class="permission-actions">
              ${!isSelf && !isStaff ? `<button class="grant-btn grant-btn-staff" onclick="devGrantStaff(${user.id})"><i class="fas fa-shield-alt"></i> Grant Staff</button>` : ''}
              ${!isSelf && isStaff && !isDev && !isHeadStaff ? `<button class="grant-btn grant-btn-revoke" onclick="devRevokeStaff(${user.id})"><i class="fas fa-times"></i> Revoke Staff</button>` : ''}
              ${!isSelf && !isHeadStaff && !isDev ? `<button class="grant-btn grant-btn-staff" style="background: #dc2626;" onclick="devGrantHeadStaff(${user.id})"><i class="fas fa-crown"></i> Grant Head Staff</button>` : ''}
              ${!isSelf && isHeadStaff && !isDev ? `<button class="grant-btn grant-btn-revoke" onclick="devRevokeHeadStaff(${user.id})"><i class="fas fa-times"></i> Revoke Head Staff</button>` : ''}
              ${!isSelf && !isDev ? `<button class="grant-btn grant-btn-dev" onclick="devGrantDev(${user.id})"><i class="fas fa-code"></i> Grant Dev</button>` : ''}
              ${!isSelf && isDev ? `<button class="grant-btn grant-btn-revoke" onclick="devRevokeDev(${user.id})"><i class="fas fa-times"></i> Revoke Dev</button>` : ''}
              ${!isSelf ? `<button class="grant-btn" style="background: #10b981; color: #04120b;" onclick="devGrantAllPanels(${user.id})"><i class="fas fa-unlock-alt"></i> Grant All Panels</button>` : ''}
              ${isSelf ? '<span style="color: #888; font-size: 0.85rem;"><i class="fas fa-info-circle"></i> You (cannot modify)</span>' : ''}
            </div>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function devGrantStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Staff Access',
        message: `Grant Staff Panel access to ${target.email}?`,
        confirmText: 'Grant',
        onConfirm: () => {
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Staff access granted.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devRevokeStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Revoke Staff Access',
        message: `Revoke Staff Panel access from ${target.email}?`,
        confirmText: 'Revoke',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].isStaff = false;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Staff access revoked.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devGrantHeadStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Head Staff',
        message: `Grant Head Staff access to ${target.email}?`,
        confirmText: 'Grant',
        onConfirm: () => {
          users[userIndex].isHeadStaff = true;
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Head Staff access granted.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devRevokeHeadStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Revoke Head Staff',
        message: `Revoke Head Staff access from ${target.email}?`,
        confirmText: 'Revoke',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].isHeadStaff = false;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Head Staff access revoked.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devGrantAllPanels(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);

      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant All Panels',
        message: `Grant Staff, Head Staff, and Dev access to ${target.email}?`,
        confirmText: 'Grant All',
        confirmClass: 'warning',
        onConfirm: () => {
          users[userIndex].isStaff = true;
          users[userIndex].isHeadStaff = true;
          users[userIndex].isDev = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'All panels access granted.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function grantAllPanelsByEmail() {
      const emailInput = document.getElementById('dev-grant-email');
      const email = emailInput ? emailInput.value.trim().toLowerCase() : '';
      if (!email) {
        showPanelMessage('dev-message', 'Please enter an email address.', 'error');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.email === email);

      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      openActionModal({
        title: 'Grant All Panels',
        message: `Grant Staff, Head Staff, and Dev access to ${email}?`,
        confirmText: 'Grant All',
        confirmClass: 'warning',
        onConfirm: () => {
          users[userIndex].isStaff = true;
          users[userIndex].isHeadStaff = true;
          users[userIndex].isDev = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === users[userIndex].id) {
            updateNavBar(currentUser);
          }

          if (emailInput) emailInput.value = '';
          showPanelMessage('dev-message', 'All panels access granted.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devGrantDev(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Developer Access',
        message: `Grant Developer access to ${target.email}? This gives full control.`,
        confirmText: 'Grant',
        confirmClass: 'warning',
        onConfirm: () => {
          users[userIndex].isDev = true;
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Developer access granted.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function devRevokeDev(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      // Check how many devs will remain
      const remainingDevs = users.filter(u => u.isDev && u.id !== userId).length;
      if (remainingDevs === 0) {
        showPanelMessage('dev-message', 'At least one developer must remain.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Revoke Developer Access',
        message: `Revoke Developer access from ${target.email}?`,
        confirmText: 'Revoke',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].isDev = false;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('dev-message', 'Developer access revoked.', 'success');
          loadDevPermissionsList();
        }
      });
    }

    function timeoutUserFromDev(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      const duration = getTimeoutDuration('dev-timeout-duration');
      if (!duration) {
        showPanelMessage('dev-message', 'Select a valid timeout duration.', 'error');
        return;
      }

      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Timeout User',
        message: `Timeout ${target.email} for ${duration.label}?`,
        confirmText: 'Timeout',
        confirmClass: 'warning',
        onConfirm: () => {
          const timeoutUntil = new Date();
          timeoutUntil.setMinutes(timeoutUntil.getMinutes() + duration.minutes);
          
          users[userIndex].timeoutUntil = timeoutUntil.toISOString();
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('dev-message', `User timed out for ${duration.label}.`, 'success');
          loadDevUserModerationList();
        }
      });
    }

    function blacklistUserFromDev(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Blacklist User',
        message: `Blacklist ${target.email}? This will block all access.`,
        confirmText: 'Blacklist',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].blacklisted = true;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showUniversalBanMessage();

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.id === userId) {
            localStorage.removeItem('currentUser');
          }

          showPanelMessage('dev-message', 'User permanently blacklisted.', 'success');
          loadDevUserModerationList();
        }
      });
    }

    function restoreUserFromDev(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Restore Access',
        message: `Restore access for ${target.email}?`,
        confirmText: 'Restore',
        onConfirm: () => {
          users[userIndex].blacklisted = false;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showPanelMessage('dev-message', 'User access restored.', 'success');
          loadDevUserModerationList();
        }
      });
    }

    function deleteAccount() {
      const email = document.getElementById('dev-target-email').value.trim().toLowerCase();
      if (!email) {
        showPanelMessage('dev-message', 'Please enter an email address.', 'error');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.email === email);

      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      // Check if trying to delete a developer
      if (users[userIndex].isDev) {
        showPanelMessage('dev-message', 'Cannot delete developer accounts.', 'error');
        return;
      }

      openActionModal({
        title: 'Delete Account',
        message: `Permanently delete ${email}? This cannot be undone.`,
        confirmText: 'Delete',
        confirmClass: 'danger',
        onConfirm: () => {
          users.splice(userIndex, 1);
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (currentUser && currentUser.email === email) {
            localStorage.removeItem('currentUser');
          }

          document.getElementById('dev-target-email').value = '';
          showPanelMessage('dev-message', 'Account permanently deleted.', 'success');
          loadDevPanel();
        }
      });
    }

    function permanentBan() {
      const email = document.getElementById('dev-target-email').value.trim().toLowerCase();
      if (!email) {
        showPanelMessage('dev-message', 'Please enter an email address.', 'error');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.email === email);

      if (userIndex === -1) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      if (users[userIndex].isDev) {
        showPanelMessage('dev-message', 'Cannot ban developer accounts.', 'error');
        return;
      }

      openActionModal({
        title: 'Permanent Ban',
        message: `Permanently ban ${email}? This will deny all access.`,
        confirmText: 'Ban',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].blacklisted = true;
          users[userIndex].timeoutUntil = null;
          localStorage.setItem('users', JSON.stringify(users));

          showUniversalBanMessage();

          document.getElementById('dev-target-email').value = '';
          showPanelMessage('dev-message', 'User permanently banned.', 'success');
          loadDevPanel();
        }
      });
    }

    function ipBan() {
      const ip = document.getElementById('dev-ip-address').value.trim();
      if (!ip) {
        showPanelMessage('dev-message', 'Please enter an IP address.', 'error');
        return;
      }

      // Basic IP validation
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipRegex.test(ip)) {
        showPanelMessage('dev-message', 'Invalid IP address format.', 'error');
        return;
      }

      let ipBans = JSON.parse(localStorage.getItem('ipBans') || '[]');
      
      if (ipBans.includes(ip)) {
        showPanelMessage('dev-message', 'This IP is already banned.', 'error');
        return;
      }

      openActionModal({
        title: 'Ban IP Address',
        message: `Ban IP address ${ip}? This will block all requests.`,
        confirmText: 'Ban',
        confirmClass: 'danger',
        onConfirm: () => {
          ipBans.push(ip);
          localStorage.setItem('ipBans', JSON.stringify(ipBans));

          showUniversalBanMessage();

          document.getElementById('dev-ip-address').value = '';
          showPanelMessage('dev-message', 'IP address banned.', 'success');
          loadDevPanel();
        }
      });
    }

    function viewIPBans() {
      const container = document.getElementById('dev-ip-bans');
      if (!container) return;

      const isHidden = container.style.display === 'none' || container.style.display === '';
      container.style.display = isHidden ? 'block' : 'none';
      if (isHidden) {
        renderIpBans();
      }
    }

    function apiBan() {
      const email = document.getElementById('dev-api-email').value.trim().toLowerCase();
      if (!email) {
        showPanelMessage('dev-message', 'Please enter an email address.', 'error');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.email === email);

      if (!user) {
        showPanelMessage('dev-message', 'User not found.', 'error');
        return;
      }

      if (user.isDev) {
        showPanelMessage('dev-message', 'Cannot API ban developer accounts.', 'error');
        return;
      }

      let apiBans = JSON.parse(localStorage.getItem('apiBans') || '[]');
      
      if (apiBans.includes(email)) {
        showPanelMessage('dev-message', 'This user is already API banned.', 'error');
        return;
      }

      openActionModal({
        title: 'Ban API Access',
        message: `Ban API access for ${email}?`,
        confirmText: 'Ban',
        confirmClass: 'danger',
        onConfirm: () => {
          apiBans.push(email);
          localStorage.setItem('apiBans', JSON.stringify(apiBans));

          showUniversalBanMessage();

          document.getElementById('dev-api-email').value = '';
          showPanelMessage('dev-message', 'User API banned.', 'success');
          loadDevPanel();
        }
      });
    }

    function viewAPIBans() {
      const container = document.getElementById('dev-api-bans');
      if (!container) return;

      const isHidden = container.style.display === 'none' || container.style.display === '';
      container.style.display = isHidden ? 'block' : 'none';
      if (isHidden) {
        renderApiBans();
      }
    }

    function updatePriceLimits() {
      const minPrice = parseFloat(document.getElementById('dev-min-price').value);
      const maxPrice = parseFloat(document.getElementById('dev-max-price').value);

      if (isNaN(minPrice) || isNaN(maxPrice)) {
        showPanelMessage('dev-message', 'Please enter valid price values.', 'error');
        return;
      }

      if (minPrice < 0) {
        showPanelMessage('dev-message', 'Minimum price cannot be negative.', 'error');
        return;
      }

      if (maxPrice <= minPrice) {
        showPanelMessage('dev-message', 'Maximum price must be greater than minimum price.', 'error');
        return;
      }

      const priceLimits = { min: minPrice, max: maxPrice };
      localStorage.setItem('priceLimits', JSON.stringify(priceLimits));

      showPanelMessage('dev-message', `Price limits updated. Min: $${minPrice} Max: $${maxPrice}`, 'success');
    }

    function toggleMaintenance() {
      const maintenanceMode = localStorage.getItem('maintenanceMode') === 'true';
      const newMode = !maintenanceMode;

      openActionModal({
        title: newMode ? 'Enable Maintenance' : 'Disable Maintenance',
        message: newMode
          ? 'Enable maintenance mode? This blocks non-developers.'
          : 'Disable maintenance mode and restore normal access?',
        confirmText: newMode ? 'Enable' : 'Disable',
        confirmClass: newMode ? 'warning' : '',
        onConfirm: () => {
          localStorage.setItem('maintenanceMode', newMode.toString());
          checkMaintenanceMode();
          loadDevPanel();
          showPanelMessage('dev-message', newMode ? 'Maintenance mode enabled.' : 'Maintenance mode disabled.', 'success');
        }
      });
    }

    function clearAllData() {
      openActionModal({
        title: 'Clear All Data',
        message: 'Clear ALL data? This deletes users, bans, and settings. This cannot be undone.',
        confirmText: 'Clear All',
        confirmClass: 'danger',
        onConfirm: () => {
          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          
          localStorage.clear();
          
          if (currentUser) {
            const devUser = {
              id: Date.now(),
              name: currentUser.name,
              email: currentUser.email,
              password: '',
              isDev: true,
              createdAt: new Date().toISOString()
            };
            localStorage.setItem('users', JSON.stringify([devUser]));
            localStorage.setItem('currentUser', JSON.stringify({ id: devUser.id, name: devUser.name, email: devUser.email }));
          }

          showPanelMessage('dev-message', 'All data cleared. Reloading...', 'success');
          setTimeout(() => location.reload(), 600);
        }
      });
    }

    function exportData() {
      const data = {
        users: JSON.parse(localStorage.getItem('users') || '[]'),
        ipBans: JSON.parse(localStorage.getItem('ipBans') || '[]'),
        apiBans: JSON.parse(localStorage.getItem('apiBans') || '[]'),
        priceLimits: JSON.parse(localStorage.getItem('priceLimits') || '{"min":1,"max":10000}'),
        maintenanceMode: localStorage.getItem('maintenanceMode') === 'true',
        exportDate: new Date().toISOString()
      };

      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `atlasfn-data-${Date.now()}.json`;
      link.click();
      URL.revokeObjectURL(url);

      showPanelMessage('dev-message', 'Data exported successfully.', 'success');
    }

    // ====== OWNER PANEL FUNCTIONS ======

    function openOwnerPanel() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === currentUser.id);

      if (!user || !user.isDev) {
        showToast('Access denied. Owner privileges required.', 'error');
        return;
      }

      document.getElementById('ownerPanel').style.display = 'flex';
      loadOwnerPanel();
    }

    // Wipe all users except dev@atlasfn.com
    function wipeAllUsers() {
      // No confirmation - dev knows what they're doing
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      // Keep only dev@atlasfn.com
      const devUser = users.find(u => u.email === 'dev@atlasfn.com');
      
      if (devUser) {
        localStorage.setItem('users', JSON.stringify([devUser]));
        showPanelMessage('dev-message', ' All users have been wiped except dev@atlasfn.com', 'success');
      } else {
        localStorage.setItem('users', JSON.stringify([]));
        showPanelMessage('dev-message', ' All users have been wiped', 'success');
      }
      
      // Also clear tickets, orders, and bans related to deleted users
      localStorage.setItem('tickets', JSON.stringify([]));
      localStorage.setItem('orders', JSON.stringify([]));
      localStorage.setItem('bans', JSON.stringify([]));
      localStorage.setItem('ipBans', JSON.stringify([]));
      localStorage.setItem('apiBans', JSON.stringify([]));
      
      // Reload panel to reflect changes
      setTimeout(() => {
        loadDevPanel();
        location.reload();
      }, 1000);
    }

    function closeOwnerPanel() {
      document.getElementById('ownerPanel').style.display = 'none';
    }

    function loadOwnerPanel() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const now = new Date();

      // Calculate stats
      const totalUsers = users.length;
      const activeUsers = users.filter(u => !u.blacklisted && (!u.timeoutUntil || new Date(u.timeoutUntil) <= now)).length;
      const staffCount = users.filter(u => u.isStaff).length;
      const devCount = users.filter(u => u.isDev).length;

      document.getElementById('owner-total-users').textContent = totalUsers;
      document.getElementById('owner-active-users').textContent = activeUsers;
      document.getElementById('owner-staff-count').textContent = staffCount;
      document.getElementById('owner-dev-count').textContent = devCount;

      // Load users list
      const container = document.getElementById('owner-users-container');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem;">No users registered yet.</p>';
        return;
      }

      users.forEach(user => {
        const isBlacklisted = user.blacklisted || false;
        const isTimedOut = user.timeoutUntil && new Date(user.timeoutUntil) > now;
        const isStaff = user.isStaff || false;
        const isHeadStaff = user.isHeadStaff || false;
        const isDev = user.isDev || false;

        let statusClass = '';
        if (isBlacklisted) statusClass = 'blacklisted';
        else if (isTimedOut) statusClass = 'timed-out';

        const userDiv = document.createElement('div');
        userDiv.className = `user-item ${statusClass}`;
        userDiv.innerHTML = `
          <div class="user-info">
            <div class="user-details">
              <h4><i class="fas fa-user"></i> ${sanitizeInput(user.name || 'User')}</h4>
              <p><i class="fas fa-envelope"></i> ${sanitizeInput(user.email)}</p>
              <p><i class="fas fa-calendar"></i> Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
              <div class="user-badges">
                ${isDev ? '<span class="badge badge-dev"><i class="fas fa-code"></i> DEVELOPER</span>' : ''}
                ${isHeadStaff ? '<span class="badge badge-head-staff"><i class="fas fa-crown"></i> HEAD STAFF</span>' : ''}
                ${isStaff ? '<span class="badge badge-staff"><i class="fas fa-shield-alt"></i> STAFF</span>' : ''}
                ${isBlacklisted ? '<span class="badge badge-blacklisted"><i class="fas fa-ban"></i> BLACKLISTED</span>' : ''}
                ${isTimedOut ? '<span class="badge badge-timeout"><i class="fas fa-clock"></i> TIMED OUT</span>' : ''}
              </div>
            </div>
            <div class="user-actions">
              ${!isStaff && !isDev ? `<button class="action-btn action-btn-staff" onclick="ownerGrantStaff(${user.id})">Grant Staff</button>` : ''}
              ${isStaff && !isDev && !isHeadStaff ? `<button class="action-btn action-btn-staff" style="background: #dc2626;" onclick="ownerGrantHeadStaff(${user.id})">Grant Head Staff</button>` : ''}
              ${!isDev ? `<button class="action-btn action-btn-staff" style="background: #ff0080;" onclick="ownerGrantDev(${user.id})">Grant Dev</button>` : ''}
              ${isDev ? `<button class="action-btn action-btn-revoke" onclick="ownerRevokeDev(${user.id})">Revoke Dev</button>` : ''}
            </div>
          </div>
        `;
        container.appendChild(userDiv);
      });
    }

    function ownerGrantStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('owner-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Staff Access',
        message: `Grant Staff access to ${target.email}?`,
        confirmText: 'Grant',
        onConfirm: () => {
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('owner-message', 'Staff access granted.', 'success');
          loadOwnerPanel();
        }
      });
    }

    function ownerGrantHeadStaff(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('owner-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Head Staff',
        message: `Grant Head Staff access to ${target.email}?`,
        confirmText: 'Grant',
        onConfirm: () => {
          users[userIndex].isHeadStaff = true;
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('owner-message', 'Head Staff access granted.', 'success');
          loadOwnerPanel();
        }
      });
    }

    function ownerGrantDev(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('owner-message', 'User not found.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Grant Developer Access',
        message: `Grant Developer access to ${target.email}? This gives full control.`,
        confirmText: 'Grant',
        confirmClass: 'warning',
        onConfirm: () => {
          users[userIndex].isDev = true;
          users[userIndex].isStaff = true;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('owner-message', 'Developer access granted.', 'success');
          loadOwnerPanel();
        }
      });
    }

    function ownerRevokeDev(userId) {
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex === -1) {
        showPanelMessage('owner-message', 'User not found.', 'error');
        return;
      }

      // Check how many devs will remain
      const remainingDevs = users.filter(u => u.isDev && u.id !== userId).length;
      if (remainingDevs === 0) {
        showPanelMessage('owner-message', 'At least one developer must remain.', 'error');
        return;
      }

      const target = users[userIndex];
      openActionModal({
        title: 'Revoke Developer Access',
        message: `Revoke Developer access from ${target.email}?`,
        confirmText: 'Revoke',
        confirmClass: 'danger',
        onConfirm: () => {
          users[userIndex].isDev = false;
          localStorage.setItem('users', JSON.stringify(users));

          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.id === userId) {
            updateNavBar(currentUser);
          }

          showPanelMessage('owner-message', 'Developer access revoked.', 'success');
          loadOwnerPanel();
        }
      });
    }

    function setTestModeBannerVisible(show) {
      const banner = document.getElementById('testModeBanner');
      if (!banner) return;
      banner.classList.toggle('show', !!show);
    }

    function applyTestModeOnLoad() {
      const isActive = sessionStorage.getItem('testModeActive') === 'true';
      if (!isActive) return;
      setTestModeBannerVisible(true);
    }

    function enterTestMode() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!currentUser) {
        showToast('You must be logged in to use test mode.', 'error');
        return;
      }

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.id === currentUser.id);
      if (userIndex === -1) {
        showToast('User not found.', 'error');
        return;
      }

      const originalPerms = {
        isDev: !!users[userIndex].isDev,
        isStaff: !!users[userIndex].isStaff,
        isHeadStaff: !!users[userIndex].isHeadStaff
      };

      sessionStorage.setItem('testModeActive', 'true');
      sessionStorage.setItem('testModeOriginalPerms', JSON.stringify(originalPerms));

      users[userIndex].isDev = false;
      users[userIndex].isStaff = false;
      users[userIndex].isHeadStaff = false;
      localStorage.setItem('users', JSON.stringify(users));

      setTestModeBannerVisible(true);
      location.reload();
    }

    function exitTestMode(skipReload) {
      const isActive = sessionStorage.getItem('testModeActive') === 'true';
      if (!isActive) return;

      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const originalPerms = JSON.parse(sessionStorage.getItem('testModeOriginalPerms') || 'null');
      const userIndex = currentUser ? users.findIndex(u => u.id === currentUser.id) : -1;

      if (userIndex !== -1 && originalPerms) {
        users[userIndex].isDev = !!originalPerms.isDev;
        users[userIndex].isStaff = !!originalPerms.isStaff;
        users[userIndex].isHeadStaff = !!originalPerms.isHeadStaff;
        localStorage.setItem('users', JSON.stringify(users));
      }

      sessionStorage.removeItem('testModeActive');
      sessionStorage.removeItem('testModeOriginalPerms');
      setTestModeBannerVisible(false);

      if (!skipReload) {
        location.reload();
      }
    }

    // Check maintenance mode on page load
    window.addEventListener('DOMContentLoaded', () => {
      checkMaintenanceMode();
    });

    // Show error message
    function showError(element, message) {
      element.textContent = ' ' + message;
      element.classList.add('show');
    }

    // ====== CROSSHAIR AND EFFECTS ======

    // Crosshair follow mouse
    const crosshair = document.getElementById('crosshair');
    let mouseX = 0, mouseY = 0;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      crosshair.style.left = mouseX + 'px';
      crosshair.style.top = mouseY + 'px';
    });

    // Shockwave effect on click
    document.addEventListener('click', (e) => {
      const shockwave = document.createElement('div');
      shockwave.className = 'shockwave';
      shockwave.style.left = e.clientX + 'px';
      shockwave.style.top = e.clientY + 'px';
      document.body.appendChild(shockwave);

      // Create multiple expanding rings
      setTimeout(() => {
        const shockwave2 = document.createElement('div');
        shockwave2.className = 'shockwave';
        shockwave2.style.left = e.clientX + 'px';
        shockwave2.style.top = e.clientY + 'px';
        shockwave2.style.animationDelay = '0.1s';
        document.body.appendChild(shockwave2);
        setTimeout(() => shockwave2.remove(), 700);
      }, 50);

      setTimeout(() => shockwave.remove(), 600);

      // Crosshair click animation
      crosshair.style.transform = 'translate(-50%, -50%) scale(0.8)';
      setTimeout(() => {
        crosshair.style.transform = 'translate(-50%, -50%) scale(1)';
      }, 100);
    });

    // ====== HEXAGONAL GRID ANIMATION ======
    const canvas = document.getElementById('hexCanvas');
    const ctx = canvas.getContext('2d');
    
    let hexMouseX = 0;
    let hexMouseY = 0;
    let hexagons = [];
    
    // Set canvas size
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      generateHexagons();
    }
    
    // Hexagon properties
    const hexRadius = 30;
    const hexHeight = Math.sin(Math.PI / 3) * hexRadius;
    
    // Generate hexagon grid
    function generateHexagons() {
      hexagons = [];
      const cols = Math.ceil(canvas.width / (hexRadius * 1.5)) + 2;
      const rows = Math.ceil(canvas.height / (hexHeight * 2)) + 2;
      
      for (let row = -1; row < rows; row++) {
        for (let col = -1; col < cols; col++) {
          const x = col * hexRadius * 1.5;
          const y = row * hexHeight * 2 + (col % 2 === 0 ? 0 : hexHeight);
          hexagons.push({ x, y });
        }
      }
    }
    
    // Draw single hexagon
    function drawHexagon(x, y, radius, opacity) {
      ctx.beginPath();
      for (let i = 0; i < 6; i++) {
        const angle = (Math.PI / 3) * i;
        const hx = x + radius * Math.cos(angle);
        const hy = y + radius * Math.sin(angle);
        if (i === 0) ctx.moveTo(hx, hy);
        else ctx.lineTo(hx, hy);
      }
      ctx.closePath();
      ctx.strokeStyle = `rgba(168, 85, 247, ${opacity})`;
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }
    
    // Animation loop
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      hexagons.forEach(hex => {
        const dx = hexMouseX - hex.x;
        const dy = hexMouseY - hex.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const maxDistance = 200;
        
        // Calculate opacity based on distance from mouse
        let opacity = 0.1;
        if (distance < maxDistance) {
          opacity = 0.6 * (1 - distance / maxDistance);
        }
        
        drawHexagon(hex.x, hex.y, hexRadius, opacity);
      });
      
      requestAnimationFrame(animate);
    }
    
    // Track mouse position for hex grid
    document.addEventListener('mousemove', (e) => {
      hexMouseX = e.clientX;
      hexMouseY = e.clientY;
    });
    
    // Handle window resize
    window.addEventListener('resize', resizeCanvas);
    
    // Initialize hex grid
    resizeCanvas();
    animate();
    
    // Update ticket badge on page load
    window.addEventListener('DOMContentLoaded', () => {
      updateTicketBadge();
      
      // Close modals when clicking outside
      const modals = ['orderHistoryModal', 'supportModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.style.display = 'none';
            }
          });
        }
      });
      
      // Close sidebar when clicking overlay
      const sidebarOverlay = document.querySelector('.sidebar-overlay');
      if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', toggleSidebar);
      }
    });
  </script>

</body>
</html>